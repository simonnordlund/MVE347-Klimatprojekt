%% Uppgift 1
U= [0.003	0.008338296	0.013676593	0.019014889	0.024353185	0.029691482	0.036029778	0.041368074	0.046706371	0.052044667	0.057382963	0.062721259	0.068059556	0.073397852	0.078736148	0.084074445	0.090412741	0.095751037	0.101089334	0.10642763	0.11176593	0.11710422	0.12244252	0.12778082	0.13311911	0.13845741	0.1447957	0.150134	0.1554723	0.16081059	0.16614889	0.17148719	0.17782548	0.18316378	0.18850207	0.19484037	0.20017867	0.20751696	0.21185526	0.21719356	0.22253185	0.22887015	0.23420845	0.23954674	0.24488504	0.25022333	0.25656163	0.26189993	0.26723822	0.27257652	0.27891482	0.28525311	0.29159141	0.2969297	0.302268	0.3076063	0.31294459	0.31928289	0.32562119	0.33095948	0.33729778	0.34263608	0.34897437	0.35431267	0.35965096	0.37098926	0.37532756	0.38066585	0.38700415	0.39234245	0.39868074	0.40801904	0.41335733	0.41969563	0.42603393	0.433372219	0.439710519	0.447048819	0.453387109	0.460725409	0.470063709	0.475401999	0.483740299	0.490078589	0.498416889	0.507755189	0.500785689	0.555622819	0.556354489	0.564817079	0.564679249	0.574934879	0.581231999	0.587232979	0.597253889	0.609966889	0.623223598	0.570716628	0.57774912	0.58613825	0.59379536	0.59691218	0.60360622	0.6072347	0.61276645	0.6166445	0.64366524	0.7403334	0.76129965	0.75771154	0.77842647	0.78787801	0.79713853	0.8050507	0.82534752	0.85724317	0.89187292	0.86066403	0.88051762	0.88712775	0.8922361	0.89814412	0.91116314	0.94173355	0.94020019	0.96775411	0.98224854	0.99719118	0.9944033	1.02336718	1.0504185	1.06527839	1.08956411	1.11600097	1.15920445	1.18720627	1.25494317	1.26897363	1.34367095	1.37229323	1.4328152	1.50353383	1.58776273	1.56141277	1.60237806	1.64098168	1.61489404	1.62684843	1.66597976	1.56479151	1.54374963	1.60911647	1.66619629	1.65030426	1.52565434	1.65328337	1.5604166	1.59294089	1.72328818	1.71986058	1.73308854	1.74448326	1.85918283	1.86467141	1.96922601	1.94887975	1.84334081	1.65922596	1.70158848	1.76986255	1.82171575	1.93129993	1.98869902	1.92388222	1.97144376	2.06583237	2.08436458	2.1110497	2.1547656	2.15139864	1.92914739	2.08014892	2.26217994	2.34413044	2.30112641	2.52233465	2.8565201	2.9056378	2.9455171	3.0171416	3.2341855	3.4226883	3.5418718	3.6495817	3.6655957	3.7692833	3.8383218	3.9355717	4.0922947	4.2595879	4.4092558	4.5986968	4.7086254	4.8232028	5.0383879	5.2731129	5.3018913	5.4460621	5.6680986	5.6827371	5.6465876	5.9736077	6.1229874	6.19537	6.4517127	6.3572096	6.2128621	6.3174055	6.3355201	6.5500833	6.7193449	6.8972023	7.0470086	7.2807248	7.4126436	7.4634833	7.6159799	7.4215304	7.4221006	7.5315956	7.6470104	7.7611025	7.8371397	7.8028431	7.7517892	7.8838	8.0279	8.1807	8.5117	8.9148	9.1665	9.237	9.3075	9.3776666	9.44783337	9.518	9.58743	9.65686	9.72629	9.79572	9.86515	9.93458	10.00401	10.07344	10.14287	10.2123	10.30803	10.40376	10.49949	10.59522	10.69095	10.78668	10.88241	10.97814	11.07387	11.1696	11.20631	11.24302	11.27973	11.31644	11.35315	11.38986	11.42657	11.46328	11.49999	11.5367	11.51102	11.48534	11.45966	11.43398	11.4083	11.38262	11.35694	11.33126	11.30558	11.2799	11.11044	10.94098	10.77152	10.60206	10.4326	10.26314	10.09368	9.92422	9.75476	9.5853	9.34897	9.11264	8.87631	8.63998	8.40365	8.16732	7.93099	7.69466	7.45833	7.222	6.91879	6.61558	6.31237	6.00916	5.70595	5.40274	5.09953	4.79632	4.49311	4.1899	4.19287	4.19584	4.19881	4.20178	4.20475	4.20772	4.21069	4.21366	4.21663	4.2196	4.22257	4.22554	4.22851	4.23148	4.23445	4.23742	4.24039	4.24336	4.24633	4.2493	4.13531	4.02132	3.90733	3.79334	3.67935	3.56536	3.45137	3.33738	3.22339	3.1094	3.02783	2.94626	2.86469	2.78312	2.70155	2.61998	2.53841	2.45684	2.37527	2.2937	2.26073	2.22776	2.19479	2.16182	2.12885	2.09588	2.06291	2.02994	1.99697	1.964	1.93853	1.91306	1.88759	1.86212	1.83665	1.81118	1.78571	1.76024	1.73477	1.7093	1.6831375	1.656975	1.6308125	1.60465	1.5784875	1.552325	1.5261625	1.5	1.5354	1.5468	1.5531	1.5547	1.5527	1.5482	1.5419	1.5324	1.5229	1.5134	1.5039	1.4944	1.48311	1.47182	1.46053	1.44924	1.43795	1.42666	1.41537	1.40408	1.39279	1.3815	1.3712	1.3609	1.3506	1.3403	1.33	1.3197	1.3094	1.2991	1.2888	1.2785	1.26966	1.26082	1.25198	1.24314	1.2343	1.22546	1.21662	1.20778	1.19894	1.1901	1.18257	1.17504	1.16751	1.15998	1.15245	1.14492	1.13739	1.12986	1.12233	1.1148	1.10836	1.10192	1.09548	1.08904	1.0826	1.07616	1.06972	1.06328	1.05684	1.0504	1.04486	1.03932	1.03378	1.02824	1.0227	1.01716	1.01162	1.00608	1.00054	0.995	0.99023	0.98546	0.98069	0.97592	0.97115	0.96638	0.96161	0.95684	0.95207	0.9473	0.94314	0.93898	0.93482	0.93066	0.9265	0.92234	0.91818	0.91402	0.90986	0.9057	0.90206	0.89842	0.89478	0.89114	0.8875	0.88386	0.88022	0.87658	0.87294	0.8693	0.8661	0.8629	0.8597	0.8565	0.8533	0.8501	0.8469	0.8437	0.8405	0.8373	0.83445	0.8316	0.82875	0.8259	0.82305	0.8202	0.81735	0.8145	0.81165	0.8088	0.80629	0.80378	0.80127	0.79876	0.79625	0.79374	0.79123	0.78872	0.78621	0.7837	0.78142	0.77914	0.77686	0.77458	0.7723	0.77002	0.76774	0.76546	0.76318	0.7609	0.75884	0.75678	0.75472	0.75266	0.7506	0.74854	0.74648	0.74442	0.74236	0.7403	0.738714	0.737128	0.735542	0.733956	0.73237	0.730784	0.729198	0.727612	0.726026	0.72444	0.722854	0.721268	0.719682	0.718096	0.71651	0.714924	0.713338	0.711752	0.710166	0.70858	0.706994	0.705408	0.703822	0.702236	0.70065	0.699064	0.697478	0.695892	0.694306	0.69272	0.691134	0.689548	0.687962	0.686376	0.68479	0.683204	0.681618	0.680032	0.678446	0.67686	0.675274	0.673688	0.672102	0.670516	0.66893	0.667344	0.665758	0.664172	0.662586	0.661	0.659886	0.658772	0.657658	0.656544	0.65543	0.654316	0.653202	0.652088	0.650974	0.64986	0.648746	0.647632	0.646518	0.645404	0.64429	0.643176	0.642062	0.640948	0.639834	0.63872	0.637606	0.636492	0.635378	0.634264	0.63315	0.632036	0.630922	0.629808	0.628694	0.62758	0.626466	0.625352	0.624238	0.623124	0.62201	0.620896	0.619782	0.618668	0.617554	0.61644	0.615326	0.614212	0.613098	0.611984	0.61087	0.609756	0.608642	0.607528	0.606414	0.6053	0.604434	0.603568	0.602702	0.601836	0.60097	0.600104	0.599238	0.598372	0.597506	0.59664	0.595774	0.594908	0.594042	0.593176	0.59231	0.591444	0.590578	0.589712	0.588846	0.58798	0.587114	0.586248	0.585382	0.584516	0.58365	0.582784	0.581918	0.581052	0.580186	0.57932	0.578454	0.577588	0.576722	0.575856	0.57499	0.574124	0.573258	0.572392	0.571526	0.57066	0.569794	0.568928	0.568062	0.567196	0.56633	0.565464	0.564598	0.563732	0.562866	0.562	0.56425	0.5665	0.56875	0.571	0.57325	0.5755	0.57775	0.58	0.58225	0.5845	0.58675	0.589	0.59125	0.5935	0.59575	0.598	0.60025	0.6025	0.60475	0.607	0.60925	0.6115	0.61375	0.616	0.61825	0.6205	0.62275	0.625	0.62725	0.6295	0.63175	0.634	0.63625	0.6385	0.64075	0.643	0.64525	0.6475	0.64975	0.652	0.65425	0.6565	0.65875	0.661	0.66325	0.6655	0.66775	0.67	0.67225	0.6745]; % Example function
CO2ConcRCP45 =	[278.05158	278.10615	278.22039	278.34305	278.47058	278.60047	278.73275	278.86881	279.00907	279.15318	279.3018	279.4568	279.61808	279.78192	279.9432	280.0974	280.2428	280.38168	280.51832	280.6572	280.8026	280.9568	281.11808	281.28192	281.4432	281.5982	281.74682	281.89093	282.03119	282.16725	282.29901	282.4268	282.55093	282.67123	282.7873	282.89901	283.00677	283.11093	283.21129	283.30737	283.39963	283.48978	283.57796	283.66116	283.73511	283.79676	283.84667	283.88853	283.92613	283.96267	284.00107	284.04267	284.08613	284.12853	284.16667	284.1982	284.22333	284.24427	284.26307	284.28133	284.30027	284.32	284.34	284.36	284.38	284.4	284.385	284.28	284.125	283.975	283.825	283.675	283.525	283.425	283.4	283.4	283.425	283.5	283.6	283.725	283.9	284.075	284.225	284.4	284.575	284.725	284.875	285	285.125	285.275	285.425	285.575	285.725	285.9	286.075	286.225	286.375	286.5	286.625	286.775	286.9	287	287.1	287.225	287.375	287.525	287.7	287.9	288.125	288.4	288.7	289.025	289.4	289.8	290.225	290.7	291.2	291.675	292.125	292.575	292.975	293.3	293.575	293.8	294	294.175	294.325	294.475	294.6	294.7	294.8	294.9	295.025	295.225	295.5	295.8	296.125	296.475	296.825	297.2	297.625	298.075	298.5	298.9	299.3	299.7	300.075	300.425	300.775	301.1	301.4	301.725	302.075	302.4	302.7	303.025	303.4	303.775	304.125	304.525	304.975	305.4	305.825	306.3	306.775	307.225	307.7	308.175	308.6	309	309.4	309.75	310	310.175	310.3	310.375	310.375	310.3	310.2	310.125	310.1	310.125	310.2	310.325	310.5	310.75	311.1	311.5	311.925	312.425	313	313.6	314.225	314.8475	315.5	316.2725	317.075	317.795	318.3975	318.925	319.6475	320.6475	321.605	322.635	323.9025	324.985	325.855	327.14	328.6775	329.7425	330.585	331.7475	333.2725	334.8475	336.525	338.36	339.7275	340.7925	342.1975	343.7825	345.2825	346.7975	348.645	350.7375	352.4875	353.855	355.0175	355.885	356.7775	358.1275	359.8375	361.4625	363.155	365.3225	367.3475	368.865	370.4675	372.5225	374.76	376.8125	378.8125	380.8275	382.7775	384.8	386.9516	389.12785	391.27357	393.4211	395.58283	397.76408	399.96631	402.18432	404.41077	406.64292	408.8817	411.12868	413.37804	415.63944	417.93551	420.27395	422.65593	425.07983	427.53791	430.0206	432.5234	435.04594	437.58886	440.13137	442.66419	445.20699	447.76978	450.35539	452.96337	455.58649	458.2152	460.84499	463.47549	466.09336	468.67807	471.23389	473.78031	476.32819	478.88085	481.43826	483.99308	486.53532	489.06035	491.53558	493.93186	496.24365	498.47436	500.64502	502.76788	504.84729	506.88408	508.87135	510.79905	512.64717	514.40151	516.06461	517.62854	519.09606	520.48828	521.81772	523.08871	524.30217	525.45089	526.50901	527.45707	528.29593	529.02718	529.64253	530.14419	530.55341	530.88313	531.13797	531.31935	531.48991	531.70213	531.94208	532.20472	532.48672	532.77553	533.06978	533.38792	533.74072	534.13086	534.55754	535.01142	535.47962	535.95487	536.4351	536.91986	537.39855	537.87136	538.3583	538.8715	539.38819	539.88381	540.35213	540.78203	541.16804	541.50962	541.80769	542.05261	542.24555	542.40767	542.55941	542.71221	542.86612	543.01262	543.13926	543.23925	543.31105	543.35475	543.35993	543.32712	543.28815	543.26597	543.26382	543.28162	543.31031	543.337	543.35452	543.36102	543.35628	543.32954	543.28277	543.23814	543.20814	543.19691	543.20476	543.22301	543.23901	543.2458	543.24169	543.22663	543.18977	543.13128	543.07193	543.02451	542.9934	542.97911	542.97309	542.96279	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532];

tspan=1:numel(U);

%plot(B(:,1))


%ylabel('Atmosfärisk stock')
%xlabel('tid')
%xlim([0,11]);
%ylim([0,3]);

alpha21 = 15/600;
alpha23 = 45/600;
alpha31 = 45/1500;
beta = 0.1:0.1:0.8;

NPP=@(B1,beta) 60*(1+beta*log(B1/600));  %Function
dB_1=@(t,B1,B2,B3,beta) alpha31*B3+alpha21*B2-NPP(B1, beta)+U(t);  %Function
dB_2=@(t,B1,B2,B3,beta) NPP(B1, beta)-alpha23*B2-alpha21*B2;       %Function
dB_3=@(t,B1,B2,B3,beta)alpha23*B2-alpha31*B3;                %Function     

dt=1;

for i=beta %Iterating over beta values

%Dummy vector to store CO2 amount.
B_1=zeros(1,length(U));
B_2=zeros(1,length(U));
B_3=zeros(1,length(U));


B_1(1) = 600; 
B_2(1) = 600; 
B_3(1) = 1500;


%Euler Forward Method to iteratively fill the B vectors.
for t=1:(length(U)-1)
    B_1(1,t + dt) = B_1(t) + dB_1(t, B_1(t), B_2(t), B_3(t), i)*dt;
    B_2(1,t + dt) = B_2(t) + dB_2(t, B_1(t), B_2(t), B_3(t), i)*dt;
    B_3(1,t + dt) = B_3(t) + dB_3(t, B_1(t), B_2(t), B_3(t), i)*dt;
end
hold on;
plot(tspan(1,:),0.469*B_1(1,:));
hold on; 


end
hold on;
plot(tspan(1,:),CO2ConcRCP45(1,:));

%% Uppgift 2
colormap('parula');
U= [0.003	0.008338296	0.013676593	0.019014889	0.024353185	0.029691482	0.036029778	0.041368074	0.046706371	0.052044667	0.057382963	0.062721259	0.068059556	0.073397852	0.078736148	0.084074445	0.090412741	0.095751037	0.101089334	0.10642763	0.11176593	0.11710422	0.12244252	0.12778082	0.13311911	0.13845741	0.1447957	0.150134	0.1554723	0.16081059	0.16614889	0.17148719	0.17782548	0.18316378	0.18850207	0.19484037	0.20017867	0.20751696	0.21185526	0.21719356	0.22253185	0.22887015	0.23420845	0.23954674	0.24488504	0.25022333	0.25656163	0.26189993	0.26723822	0.27257652	0.27891482	0.28525311	0.29159141	0.2969297	0.302268	0.3076063	0.31294459	0.31928289	0.32562119	0.33095948	0.33729778	0.34263608	0.34897437	0.35431267	0.35965096	0.37098926	0.37532756	0.38066585	0.38700415	0.39234245	0.39868074	0.40801904	0.41335733	0.41969563	0.42603393	0.433372219	0.439710519	0.447048819	0.453387109	0.460725409	0.470063709	0.475401999	0.483740299	0.490078589	0.498416889	0.507755189	0.500785689	0.555622819	0.556354489	0.564817079	0.564679249	0.574934879	0.581231999	0.587232979	0.597253889	0.609966889	0.623223598	0.570716628	0.57774912	0.58613825	0.59379536	0.59691218	0.60360622	0.6072347	0.61276645	0.6166445	0.64366524	0.7403334	0.76129965	0.75771154	0.77842647	0.78787801	0.79713853	0.8050507	0.82534752	0.85724317	0.89187292	0.86066403	0.88051762	0.88712775	0.8922361	0.89814412	0.91116314	0.94173355	0.94020019	0.96775411	0.98224854	0.99719118	0.9944033	1.02336718	1.0504185	1.06527839	1.08956411	1.11600097	1.15920445	1.18720627	1.25494317	1.26897363	1.34367095	1.37229323	1.4328152	1.50353383	1.58776273	1.56141277	1.60237806	1.64098168	1.61489404	1.62684843	1.66597976	1.56479151	1.54374963	1.60911647	1.66619629	1.65030426	1.52565434	1.65328337	1.5604166	1.59294089	1.72328818	1.71986058	1.73308854	1.74448326	1.85918283	1.86467141	1.96922601	1.94887975	1.84334081	1.65922596	1.70158848	1.76986255	1.82171575	1.93129993	1.98869902	1.92388222	1.97144376	2.06583237	2.08436458	2.1110497	2.1547656	2.15139864	1.92914739	2.08014892	2.26217994	2.34413044	2.30112641	2.52233465	2.8565201	2.9056378	2.9455171	3.0171416	3.2341855	3.4226883	3.5418718	3.6495817	3.6655957	3.7692833	3.8383218	3.9355717	4.0922947	4.2595879	4.4092558	4.5986968	4.7086254	4.8232028	5.0383879	5.2731129	5.3018913	5.4460621	5.6680986	5.6827371	5.6465876	5.9736077	6.1229874	6.19537	6.4517127	6.3572096	6.2128621	6.3174055	6.3355201	6.5500833	6.7193449	6.8972023	7.0470086	7.2807248	7.4126436	7.4634833	7.6159799	7.4215304	7.4221006	7.5315956	7.6470104	7.7611025	7.8371397	7.8028431	7.7517892	7.8838	8.0279	8.1807	8.5117	8.9148	9.1665	9.237	9.3075	9.3776666	9.44783337	9.518	9.58743	9.65686	9.72629	9.79572	9.86515	9.93458	10.00401	10.07344	10.14287	10.2123	10.30803	10.40376	10.49949	10.59522	10.69095	10.78668	10.88241	10.97814	11.07387	11.1696	11.20631	11.24302	11.27973	11.31644	11.35315	11.38986	11.42657	11.46328	11.49999	11.5367	11.51102	11.48534	11.45966	11.43398	11.4083	11.38262	11.35694	11.33126	11.30558	11.2799	11.11044	10.94098	10.77152	10.60206	10.4326	10.26314	10.09368	9.92422	9.75476	9.5853	9.34897	9.11264	8.87631	8.63998	8.40365	8.16732	7.93099	7.69466	7.45833	7.222	6.91879	6.61558	6.31237	6.00916	5.70595	5.40274	5.09953	4.79632	4.49311	4.1899	4.19287	4.19584	4.19881	4.20178	4.20475	4.20772	4.21069	4.21366	4.21663	4.2196	4.22257	4.22554	4.22851	4.23148	4.23445	4.23742	4.24039	4.24336	4.24633	4.2493	4.13531	4.02132	3.90733	3.79334	3.67935	3.56536	3.45137	3.33738	3.22339	3.1094	3.02783	2.94626	2.86469	2.78312	2.70155	2.61998	2.53841	2.45684	2.37527	2.2937	2.26073	2.22776	2.19479	2.16182	2.12885	2.09588	2.06291	2.02994	1.99697	1.964	1.93853	1.91306	1.88759	1.86212	1.83665	1.81118	1.78571	1.76024	1.73477	1.7093	1.6831375	1.656975	1.6308125	1.60465	1.5784875	1.552325	1.5261625	1.5	1.5354	1.5468	1.5531	1.5547	1.5527	1.5482	1.5419	1.5324	1.5229	1.5134	1.5039	1.4944	1.48311	1.47182	1.46053	1.44924	1.43795	1.42666	1.41537	1.40408	1.39279	1.3815	1.3712	1.3609	1.3506	1.3403	1.33	1.3197	1.3094	1.2991	1.2888	1.2785	1.26966	1.26082	1.25198	1.24314	1.2343	1.22546	1.21662	1.20778	1.19894	1.1901	1.18257	1.17504	1.16751	1.15998	1.15245	1.14492	1.13739	1.12986	1.12233	1.1148	1.10836	1.10192	1.09548	1.08904	1.0826	1.07616	1.06972	1.06328	1.05684	1.0504	1.04486	1.03932	1.03378	1.02824	1.0227	1.01716	1.01162	1.00608	1.00054	0.995	0.99023	0.98546	0.98069	0.97592	0.97115	0.96638	0.96161	0.95684	0.95207	0.9473	0.94314	0.93898	0.93482	0.93066	0.9265	0.92234	0.91818	0.91402	0.90986	0.9057	0.90206	0.89842	0.89478	0.89114	0.8875	0.88386	0.88022	0.87658	0.87294	0.8693	0.8661	0.8629	0.8597	0.8565	0.8533	0.8501	0.8469	0.8437	0.8405	0.8373	0.83445	0.8316	0.82875	0.8259	0.82305	0.8202	0.81735	0.8145	0.81165	0.8088	0.80629	0.80378	0.80127	0.79876	0.79625	0.79374	0.79123	0.78872	0.78621	0.7837	0.78142	0.77914	0.77686	0.77458	0.7723	0.77002	0.76774	0.76546	0.76318	0.7609	0.75884	0.75678	0.75472	0.75266	0.7506	0.74854	0.74648	0.74442	0.74236	0.7403	0.738714	0.737128	0.735542	0.733956	0.73237	0.730784	0.729198	0.727612	0.726026	0.72444	0.722854	0.721268	0.719682	0.718096	0.71651	0.714924	0.713338	0.711752	0.710166	0.70858	0.706994	0.705408	0.703822	0.702236	0.70065	0.699064	0.697478	0.695892	0.694306	0.69272	0.691134	0.689548	0.687962	0.686376	0.68479	0.683204	0.681618	0.680032	0.678446	0.67686	0.675274	0.673688	0.672102	0.670516	0.66893	0.667344	0.665758	0.664172	0.662586	0.661	0.659886	0.658772	0.657658	0.656544	0.65543	0.654316	0.653202	0.652088	0.650974	0.64986	0.648746	0.647632	0.646518	0.645404	0.64429	0.643176	0.642062	0.640948	0.639834	0.63872	0.637606	0.636492	0.635378	0.634264	0.63315	0.632036	0.630922	0.629808	0.628694	0.62758	0.626466	0.625352	0.624238	0.623124	0.62201	0.620896	0.619782	0.618668	0.617554	0.61644	0.615326	0.614212	0.613098	0.611984	0.61087	0.609756	0.608642	0.607528	0.606414	0.6053	0.604434	0.603568	0.602702	0.601836	0.60097	0.600104	0.599238	0.598372	0.597506	0.59664	0.595774	0.594908	0.594042	0.593176	0.59231	0.591444	0.590578	0.589712	0.588846	0.58798	0.587114	0.586248	0.585382	0.584516	0.58365	0.582784	0.581918	0.581052	0.580186	0.57932	0.578454	0.577588	0.576722	0.575856	0.57499	0.574124	0.573258	0.572392	0.571526	0.57066	0.569794	0.568928	0.568062	0.567196	0.56633	0.565464	0.564598	0.563732	0.562866	0.562	0.56425	0.5665	0.56875	0.571	0.57325	0.5755	0.57775	0.58	0.58225	0.5845	0.58675	0.589	0.59125	0.5935	0.59575	0.598	0.60025	0.6025	0.60475	0.607	0.60925	0.6115	0.61375	0.616	0.61825	0.6205	0.62275	0.625	0.62725	0.6295	0.63175	0.634	0.63625	0.6385	0.64075	0.643	0.64525	0.6475	0.64975	0.652	0.65425	0.6565	0.65875	0.661	0.66325	0.6655	0.66775	0.67	0.67225	0.6745]; % Example function
CO2ConcRCP45 =	[278.05158	278.10615	278.22039	278.34305	278.47058	278.60047	278.73275	278.86881	279.00907	279.15318	279.3018	279.4568	279.61808	279.78192	279.9432	280.0974	280.2428	280.38168	280.51832	280.6572	280.8026	280.9568	281.11808	281.28192	281.4432	281.5982	281.74682	281.89093	282.03119	282.16725	282.29901	282.4268	282.55093	282.67123	282.7873	282.89901	283.00677	283.11093	283.21129	283.30737	283.39963	283.48978	283.57796	283.66116	283.73511	283.79676	283.84667	283.88853	283.92613	283.96267	284.00107	284.04267	284.08613	284.12853	284.16667	284.1982	284.22333	284.24427	284.26307	284.28133	284.30027	284.32	284.34	284.36	284.38	284.4	284.385	284.28	284.125	283.975	283.825	283.675	283.525	283.425	283.4	283.4	283.425	283.5	283.6	283.725	283.9	284.075	284.225	284.4	284.575	284.725	284.875	285	285.125	285.275	285.425	285.575	285.725	285.9	286.075	286.225	286.375	286.5	286.625	286.775	286.9	287	287.1	287.225	287.375	287.525	287.7	287.9	288.125	288.4	288.7	289.025	289.4	289.8	290.225	290.7	291.2	291.675	292.125	292.575	292.975	293.3	293.575	293.8	294	294.175	294.325	294.475	294.6	294.7	294.8	294.9	295.025	295.225	295.5	295.8	296.125	296.475	296.825	297.2	297.625	298.075	298.5	298.9	299.3	299.7	300.075	300.425	300.775	301.1	301.4	301.725	302.075	302.4	302.7	303.025	303.4	303.775	304.125	304.525	304.975	305.4	305.825	306.3	306.775	307.225	307.7	308.175	308.6	309	309.4	309.75	310	310.175	310.3	310.375	310.375	310.3	310.2	310.125	310.1	310.125	310.2	310.325	310.5	310.75	311.1	311.5	311.925	312.425	313	313.6	314.225	314.8475	315.5	316.2725	317.075	317.795	318.3975	318.925	319.6475	320.6475	321.605	322.635	323.9025	324.985	325.855	327.14	328.6775	329.7425	330.585	331.7475	333.2725	334.8475	336.525	338.36	339.7275	340.7925	342.1975	343.7825	345.2825	346.7975	348.645	350.7375	352.4875	353.855	355.0175	355.885	356.7775	358.1275	359.8375	361.4625	363.155	365.3225	367.3475	368.865	370.4675	372.5225	374.76	376.8125	378.8125	380.8275	382.7775	384.8	386.9516	389.12785	391.27357	393.4211	395.58283	397.76408	399.96631	402.18432	404.41077	406.64292	408.8817	411.12868	413.37804	415.63944	417.93551	420.27395	422.65593	425.07983	427.53791	430.0206	432.5234	435.04594	437.58886	440.13137	442.66419	445.20699	447.76978	450.35539	452.96337	455.58649	458.2152	460.84499	463.47549	466.09336	468.67807	471.23389	473.78031	476.32819	478.88085	481.43826	483.99308	486.53532	489.06035	491.53558	493.93186	496.24365	498.47436	500.64502	502.76788	504.84729	506.88408	508.87135	510.79905	512.64717	514.40151	516.06461	517.62854	519.09606	520.48828	521.81772	523.08871	524.30217	525.45089	526.50901	527.45707	528.29593	529.02718	529.64253	530.14419	530.55341	530.88313	531.13797	531.31935	531.48991	531.70213	531.94208	532.20472	532.48672	532.77553	533.06978	533.38792	533.74072	534.13086	534.55754	535.01142	535.47962	535.95487	536.4351	536.91986	537.39855	537.87136	538.3583	538.8715	539.38819	539.88381	540.35213	540.78203	541.16804	541.50962	541.80769	542.05261	542.24555	542.40767	542.55941	542.71221	542.86612	543.01262	543.13926	543.23925	543.31105	543.35475	543.35993	543.32712	543.28815	543.26597	543.26382	543.28162	543.31031	543.337	543.35452	543.36102	543.35628	543.32954	543.28277	543.23814	543.20814	543.19691	543.20476	543.22301	543.23901	543.2458	543.24169	543.22663	543.18977	543.13128	543.07193	543.02451	542.9934	542.97911	542.97309	542.96279	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532];

tspan=1:numel(U);

%plot(B(:,1))


%ylabel('Atmosfärisk stock')
%xlabel('tid')
%xlim([0,11]);
%ylim([0,3]);

alpha21 = 15/600;
alpha23 = 45/600;
alpha31 = 45/1500;
beta = 0.1:0.1:0.8;

NPP = @(B1,beta) 60*(1 + beta .* log(B1./600));  %Function
dB_1 = @(t,B1,B2,B3,beta) alpha31 .* B3 + alpha21 .* B2 - NPP(B1, beta) + U(t);  %Function
dB_2 = @(t,B1,B2,B3,beta) NPP(B1, beta) - alpha23 .* B2 - alpha21 .* B2;         %Function
dB_3 = @(t,B1,B2,B3,beta) alpha23 .* B2 - alpha31.*B3;                %Function     

dt=1;

figure(1);
hold on;

figure(2);
hold on;

figure(3);
hold on;

for i=beta %Iterating over beta values

%Dummy vector to store CO2 amount.
B_1 = zeros(1,length(U));
B_2 = zeros(1,length(U));
B_3 = zeros(1,length(U));


B_1(1) = 600; 
B_2(1) = 600; 
B_3(1) = 1500;


%Euler Forward Method to iteratively fill the B vectors.
for t=1:(length(U)-1)
    B_1(1,t + dt) = B_1(t) + dB_1(t, B_1(t), B_2(t), B_3(t), i)*dt;
    B_2(1,t + dt) = B_2(t) + dB_2(t, B_1(t), B_2(t), B_3(t), i)*dt;
    B_3(1,t + dt) = B_3(t) + dB_3(t, B_1(t), B_2(t), B_3(t), i)*dt;
end

figure(1);
plot(tspan(1,:),0.469.*B_1(1,:), 'LineWidth', 2);


figure(2);
plot(tspan(1,:), B_2(1,:), 'LineWidth', 2 );


figure(3);
plot(tspan(1,:), B_3(1,:), 'LineWidth', 2 );



end
figure(1);
plot(tspan(1,:),CO2ConcRCP45(1,:), 'LineWidth', 2);
legend("beta_1", "beta_2", "beta_3", "beta_4", "beta_5", "beta_6", "beta_7", "beta_8", "Reference" )

figure(2);
legend("beta_1", "beta_2", "beta_3", "beta_4", "beta_5", "beta_6", "beta_7", "beta_8" )

figure(3);
legend("beta_1", "beta_2", "beta_3", "beta_4", "beta_5", "beta_6", "beta_7", "beta_8" )
%% Uppgift 3a


A = [0.113 0.213 0.258 0.273 0.1430];
tau = [2.0 12.2 50.4 243.3 inf];
PE = [0 140 560 1680];
t = 0:1:500;
k = 3.06*10^(-3);



for i=1:length(PE)
    sum_I = 0;
    tau_i = tau .* (1 + k .* PE(i) );
    for j = 1:length(A)
        sum_I = sum_I + A(j) .* exp(-t ./ tau_i(j) );
    end
    hold on;
    plot(t, sum_I)
    
end
legend("0 GtC", "140 GtC", "560 GtC", "1680 GtC")


        
%% Uppgift 4

U= [0.003	0.008338296	0.013676593	0.019014889	0.024353185	0.029691482	0.036029778	0.041368074	0.046706371	0.052044667	0.057382963	0.062721259	0.068059556	0.073397852	0.078736148	0.084074445	0.090412741	0.095751037	0.101089334	0.10642763	0.11176593	0.11710422	0.12244252	0.12778082	0.13311911	0.13845741	0.1447957	0.150134	0.1554723	0.16081059	0.16614889	0.17148719	0.17782548	0.18316378	0.18850207	0.19484037	0.20017867	0.20751696	0.21185526	0.21719356	0.22253185	0.22887015	0.23420845	0.23954674	0.24488504	0.25022333	0.25656163	0.26189993	0.26723822	0.27257652	0.27891482	0.28525311	0.29159141	0.2969297	0.302268	0.3076063	0.31294459	0.31928289	0.32562119	0.33095948	0.33729778	0.34263608	0.34897437	0.35431267	0.35965096	0.37098926	0.37532756	0.38066585	0.38700415	0.39234245	0.39868074	0.40801904	0.41335733	0.41969563	0.42603393	0.433372219	0.439710519	0.447048819	0.453387109	0.460725409	0.470063709	0.475401999	0.483740299	0.490078589	0.498416889	0.507755189	0.500785689	0.555622819	0.556354489	0.564817079	0.564679249	0.574934879	0.581231999	0.587232979	0.597253889	0.609966889	0.623223598	0.570716628	0.57774912	0.58613825	0.59379536	0.59691218	0.60360622	0.6072347	0.61276645	0.6166445	0.64366524	0.7403334	0.76129965	0.75771154	0.77842647	0.78787801	0.79713853	0.8050507	0.82534752	0.85724317	0.89187292	0.86066403	0.88051762	0.88712775	0.8922361	0.89814412	0.91116314	0.94173355	0.94020019	0.96775411	0.98224854	0.99719118	0.9944033	1.02336718	1.0504185	1.06527839	1.08956411	1.11600097	1.15920445	1.18720627	1.25494317	1.26897363	1.34367095	1.37229323	1.4328152	1.50353383	1.58776273	1.56141277	1.60237806	1.64098168	1.61489404	1.62684843	1.66597976	1.56479151	1.54374963	1.60911647	1.66619629	1.65030426	1.52565434	1.65328337	1.5604166	1.59294089	1.72328818	1.71986058	1.73308854	1.74448326	1.85918283	1.86467141	1.96922601	1.94887975	1.84334081	1.65922596	1.70158848	1.76986255	1.82171575	1.93129993	1.98869902	1.92388222	1.97144376	2.06583237	2.08436458	2.1110497	2.1547656	2.15139864	1.92914739	2.08014892	2.26217994	2.34413044	2.30112641	2.52233465	2.8565201	2.9056378	2.9455171	3.0171416	3.2341855	3.4226883	3.5418718	3.6495817	3.6655957	3.7692833	3.8383218	3.9355717	4.0922947	4.2595879	4.4092558	4.5986968	4.7086254	4.8232028	5.0383879	5.2731129	5.3018913	5.4460621	5.6680986	5.6827371	5.6465876	5.9736077	6.1229874	6.19537	6.4517127	6.3572096	6.2128621	6.3174055	6.3355201	6.5500833	6.7193449	6.8972023	7.0470086	7.2807248	7.4126436	7.4634833	7.6159799	7.4215304	7.4221006	7.5315956	7.6470104	7.7611025	7.8371397	7.8028431	7.7517892	7.8838	8.0279	8.1807	8.5117	8.9148	9.1665	9.237	9.3075	9.3776666	9.44783337	9.518	9.58743	9.65686	9.72629	9.79572	9.86515	9.93458	10.00401	10.07344	10.14287	10.2123	10.30803	10.40376	10.49949	10.59522	10.69095	10.78668	10.88241	10.97814	11.07387	11.1696	11.20631	11.24302	11.27973	11.31644	11.35315	11.38986	11.42657	11.46328	11.49999	11.5367	11.51102	11.48534	11.45966	11.43398	11.4083	11.38262	11.35694	11.33126	11.30558	11.2799	11.11044	10.94098	10.77152	10.60206	10.4326	10.26314	10.09368	9.92422	9.75476	9.5853	9.34897	9.11264	8.87631	8.63998	8.40365	8.16732	7.93099	7.69466	7.45833	7.222	6.91879	6.61558	6.31237	6.00916	5.70595	5.40274	5.09953	4.79632	4.49311	4.1899	4.19287	4.19584	4.19881	4.20178	4.20475	4.20772	4.21069	4.21366	4.21663	4.2196	4.22257	4.22554	4.22851	4.23148	4.23445	4.23742	4.24039	4.24336	4.24633	4.2493	4.13531	4.02132	3.90733	3.79334	3.67935	3.56536	3.45137	3.33738	3.22339	3.1094	3.02783	2.94626	2.86469	2.78312	2.70155	2.61998	2.53841	2.45684	2.37527	2.2937	2.26073	2.22776	2.19479	2.16182	2.12885	2.09588	2.06291	2.02994	1.99697	1.964	1.93853	1.91306	1.88759	1.86212	1.83665	1.81118	1.78571	1.76024	1.73477	1.7093	1.6831375	1.656975	1.6308125	1.60465	1.5784875	1.552325	1.5261625	1.5	1.5354	1.5468	1.5531	1.5547	1.5527	1.5482	1.5419	1.5324	1.5229	1.5134	1.5039	1.4944	1.48311	1.47182	1.46053	1.44924	1.43795	1.42666	1.41537	1.40408	1.39279	1.3815	1.3712	1.3609	1.3506	1.3403	1.33	1.3197	1.3094	1.2991	1.2888	1.2785	1.26966	1.26082	1.25198	1.24314	1.2343	1.22546	1.21662	1.20778	1.19894	1.1901	1.18257	1.17504	1.16751	1.15998	1.15245	1.14492	1.13739	1.12986	1.12233	1.1148	1.10836	1.10192	1.09548	1.08904	1.0826	1.07616	1.06972	1.06328	1.05684	1.0504	1.04486	1.03932	1.03378	1.02824	1.0227	1.01716	1.01162	1.00608	1.00054	0.995	0.99023	0.98546	0.98069	0.97592	0.97115	0.96638	0.96161	0.95684	0.95207	0.9473	0.94314	0.93898	0.93482	0.93066	0.9265	0.92234	0.91818	0.91402	0.90986	0.9057	0.90206	0.89842	0.89478	0.89114	0.8875	0.88386	0.88022	0.87658	0.87294	0.8693	0.8661	0.8629	0.8597	0.8565	0.8533	0.8501	0.8469	0.8437	0.8405	0.8373	0.83445	0.8316	0.82875	0.8259	0.82305	0.8202	0.81735	0.8145	0.81165	0.8088	0.80629	0.80378	0.80127	0.79876	0.79625	0.79374	0.79123	0.78872	0.78621	0.7837	0.78142	0.77914	0.77686	0.77458	0.7723	0.77002	0.76774	0.76546	0.76318	0.7609	0.75884	0.75678	0.75472	0.75266	0.7506	0.74854	0.74648	0.74442	0.74236	0.7403	0.738714	0.737128	0.735542	0.733956	0.73237	0.730784	0.729198	0.727612	0.726026	0.72444	0.722854	0.721268	0.719682	0.718096	0.71651	0.714924	0.713338	0.711752	0.710166	0.70858	0.706994	0.705408	0.703822	0.702236	0.70065	0.699064	0.697478	0.695892	0.694306	0.69272	0.691134	0.689548	0.687962	0.686376	0.68479	0.683204	0.681618	0.680032	0.678446	0.67686	0.675274	0.673688	0.672102	0.670516	0.66893	0.667344	0.665758	0.664172	0.662586	0.661	0.659886	0.658772	0.657658	0.656544	0.65543	0.654316	0.653202	0.652088	0.650974	0.64986	0.648746	0.647632	0.646518	0.645404	0.64429	0.643176	0.642062	0.640948	0.639834	0.63872	0.637606	0.636492	0.635378	0.634264	0.63315	0.632036	0.630922	0.629808	0.628694	0.62758	0.626466	0.625352	0.624238	0.623124	0.62201	0.620896	0.619782	0.618668	0.617554	0.61644	0.615326	0.614212	0.613098	0.611984	0.61087	0.609756	0.608642	0.607528	0.606414	0.6053	0.604434	0.603568	0.602702	0.601836	0.60097	0.600104	0.599238	0.598372	0.597506	0.59664	0.595774	0.594908	0.594042	0.593176	0.59231	0.591444	0.590578	0.589712	0.588846	0.58798	0.587114	0.586248	0.585382	0.584516	0.58365	0.582784	0.581918	0.581052	0.580186	0.57932	0.578454	0.577588	0.576722	0.575856	0.57499	0.574124	0.573258	0.572392	0.571526	0.57066	0.569794	0.568928	0.568062	0.567196	0.56633	0.565464	0.564598	0.563732	0.562866	0.562	0.56425	0.5665	0.56875	0.571	0.57325	0.5755	0.57775	0.58	0.58225	0.5845	0.58675	0.589	0.59125	0.5935	0.59575	0.598	0.60025	0.6025	0.60475	0.607	0.60925	0.6115	0.61375	0.616	0.61825	0.6205	0.62275	0.625	0.62725	0.6295	0.63175	0.634	0.63625	0.6385	0.64075	0.643	0.64525	0.6475	0.64975	0.652	0.65425	0.6565	0.65875	0.661	0.66325	0.6655	0.66775	0.67	0.67225	0.6745]; % Example function
CO2ConcRCP45 =	[278.05158	278.10615	278.22039	278.34305	278.47058	278.60047	278.73275	278.86881	279.00907	279.15318	279.3018	279.4568	279.61808	279.78192	279.9432	280.0974	280.2428	280.38168	280.51832	280.6572	280.8026	280.9568	281.11808	281.28192	281.4432	281.5982	281.74682	281.89093	282.03119	282.16725	282.29901	282.4268	282.55093	282.67123	282.7873	282.89901	283.00677	283.11093	283.21129	283.30737	283.39963	283.48978	283.57796	283.66116	283.73511	283.79676	283.84667	283.88853	283.92613	283.96267	284.00107	284.04267	284.08613	284.12853	284.16667	284.1982	284.22333	284.24427	284.26307	284.28133	284.30027	284.32	284.34	284.36	284.38	284.4	284.385	284.28	284.125	283.975	283.825	283.675	283.525	283.425	283.4	283.4	283.425	283.5	283.6	283.725	283.9	284.075	284.225	284.4	284.575	284.725	284.875	285	285.125	285.275	285.425	285.575	285.725	285.9	286.075	286.225	286.375	286.5	286.625	286.775	286.9	287	287.1	287.225	287.375	287.525	287.7	287.9	288.125	288.4	288.7	289.025	289.4	289.8	290.225	290.7	291.2	291.675	292.125	292.575	292.975	293.3	293.575	293.8	294	294.175	294.325	294.475	294.6	294.7	294.8	294.9	295.025	295.225	295.5	295.8	296.125	296.475	296.825	297.2	297.625	298.075	298.5	298.9	299.3	299.7	300.075	300.425	300.775	301.1	301.4	301.725	302.075	302.4	302.7	303.025	303.4	303.775	304.125	304.525	304.975	305.4	305.825	306.3	306.775	307.225	307.7	308.175	308.6	309	309.4	309.75	310	310.175	310.3	310.375	310.375	310.3	310.2	310.125	310.1	310.125	310.2	310.325	310.5	310.75	311.1	311.5	311.925	312.425	313	313.6	314.225	314.8475	315.5	316.2725	317.075	317.795	318.3975	318.925	319.6475	320.6475	321.605	322.635	323.9025	324.985	325.855	327.14	328.6775	329.7425	330.585	331.7475	333.2725	334.8475	336.525	338.36	339.7275	340.7925	342.1975	343.7825	345.2825	346.7975	348.645	350.7375	352.4875	353.855	355.0175	355.885	356.7775	358.1275	359.8375	361.4625	363.155	365.3225	367.3475	368.865	370.4675	372.5225	374.76	376.8125	378.8125	380.8275	382.7775	384.8	386.9516	389.12785	391.27357	393.4211	395.58283	397.76408	399.96631	402.18432	404.41077	406.64292	408.8817	411.12868	413.37804	415.63944	417.93551	420.27395	422.65593	425.07983	427.53791	430.0206	432.5234	435.04594	437.58886	440.13137	442.66419	445.20699	447.76978	450.35539	452.96337	455.58649	458.2152	460.84499	463.47549	466.09336	468.67807	471.23389	473.78031	476.32819	478.88085	481.43826	483.99308	486.53532	489.06035	491.53558	493.93186	496.24365	498.47436	500.64502	502.76788	504.84729	506.88408	508.87135	510.79905	512.64717	514.40151	516.06461	517.62854	519.09606	520.48828	521.81772	523.08871	524.30217	525.45089	526.50901	527.45707	528.29593	529.02718	529.64253	530.14419	530.55341	530.88313	531.13797	531.31935	531.48991	531.70213	531.94208	532.20472	532.48672	532.77553	533.06978	533.38792	533.74072	534.13086	534.55754	535.01142	535.47962	535.95487	536.4351	536.91986	537.39855	537.87136	538.3583	538.8715	539.38819	539.88381	540.35213	540.78203	541.16804	541.50962	541.80769	542.05261	542.24555	542.40767	542.55941	542.71221	542.86612	543.01262	543.13926	543.23925	543.31105	543.35475	543.35993	543.32712	543.28815	543.26597	543.26382	543.28162	543.31031	543.337	543.35452	543.36102	543.35628	543.32954	543.28277	543.23814	543.20814	543.19691	543.20476	543.22301	543.23901	543.2458	543.24169	543.22663	543.18977	543.13128	543.07193	543.02451	542.9934	542.97911	542.97309	542.96279	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532];

A = [0.113 0.213 0.258 0.273 0.1430];
tau = [2.0 12.2 50.4 243.3 inf];
PE = [0 140 560 1680];
tspan=1:numel(U);
k = 3.06*10^(-3);
M_0 = 600;



M=zeros(1,length(tspan));
M(1)=M_0;
for t=2:length(tspan)
    sum_M=0;
    for t_hat=1:t
        sum_I = 0;
        tau_i = tau .* (1 + k .* sum(U(1:t-1)) );
        for i = 1:length(A)
            sum_I = sum_I + A(i) .* exp(-(t - t_hat) ./ tau_i(i) );
        end
        sum_M=sum_M+sum_I*U(t_hat);
    end
    M(t)=M_0+sum_M;
end


plot(tspan,0.469*M)
hold on;
plot(tspan,CO2ConcRCP45)

%% Uppgift 6

U= [0.003	0.008338296	0.013676593	0.019014889	0.024353185	0.029691482	0.036029778	0.041368074	0.046706371	0.052044667	0.057382963	0.062721259	0.068059556	0.073397852	0.078736148	0.084074445	0.090412741	0.095751037	0.101089334	0.10642763	0.11176593	0.11710422	0.12244252	0.12778082	0.13311911	0.13845741	0.1447957	0.150134	0.1554723	0.16081059	0.16614889	0.17148719	0.17782548	0.18316378	0.18850207	0.19484037	0.20017867	0.20751696	0.21185526	0.21719356	0.22253185	0.22887015	0.23420845	0.23954674	0.24488504	0.25022333	0.25656163	0.26189993	0.26723822	0.27257652	0.27891482	0.28525311	0.29159141	0.2969297	0.302268	0.3076063	0.31294459	0.31928289	0.32562119	0.33095948	0.33729778	0.34263608	0.34897437	0.35431267	0.35965096	0.37098926	0.37532756	0.38066585	0.38700415	0.39234245	0.39868074	0.40801904	0.41335733	0.41969563	0.42603393	0.433372219	0.439710519	0.447048819	0.453387109	0.460725409	0.470063709	0.475401999	0.483740299	0.490078589	0.498416889	0.507755189	0.500785689	0.555622819	0.556354489	0.564817079	0.564679249	0.574934879	0.581231999	0.587232979	0.597253889	0.609966889	0.623223598	0.570716628	0.57774912	0.58613825	0.59379536	0.59691218	0.60360622	0.6072347	0.61276645	0.6166445	0.64366524	0.7403334	0.76129965	0.75771154	0.77842647	0.78787801	0.79713853	0.8050507	0.82534752	0.85724317	0.89187292	0.86066403	0.88051762	0.88712775	0.8922361	0.89814412	0.91116314	0.94173355	0.94020019	0.96775411	0.98224854	0.99719118	0.9944033	1.02336718	1.0504185	1.06527839	1.08956411	1.11600097	1.15920445	1.18720627	1.25494317	1.26897363	1.34367095	1.37229323	1.4328152	1.50353383	1.58776273	1.56141277	1.60237806	1.64098168	1.61489404	1.62684843	1.66597976	1.56479151	1.54374963	1.60911647	1.66619629	1.65030426	1.52565434	1.65328337	1.5604166	1.59294089	1.72328818	1.71986058	1.73308854	1.74448326	1.85918283	1.86467141	1.96922601	1.94887975	1.84334081	1.65922596	1.70158848	1.76986255	1.82171575	1.93129993	1.98869902	1.92388222	1.97144376	2.06583237	2.08436458	2.1110497	2.1547656	2.15139864	1.92914739	2.08014892	2.26217994	2.34413044	2.30112641	2.52233465	2.8565201	2.9056378	2.9455171	3.0171416	3.2341855	3.4226883	3.5418718	3.6495817	3.6655957	3.7692833	3.8383218	3.9355717	4.0922947	4.2595879	4.4092558	4.5986968	4.7086254	4.8232028	5.0383879	5.2731129	5.3018913	5.4460621	5.6680986	5.6827371	5.6465876	5.9736077	6.1229874	6.19537	6.4517127	6.3572096	6.2128621	6.3174055	6.3355201	6.5500833	6.7193449	6.8972023	7.0470086	7.2807248	7.4126436	7.4634833	7.6159799	7.4215304	7.4221006	7.5315956	7.6470104	7.7611025	7.8371397	7.8028431	7.7517892	7.8838	8.0279	8.1807	8.5117	8.9148	9.1665	9.237	9.3075	9.3776666	9.44783337	9.518	9.58743	9.65686	9.72629	9.79572	9.86515	9.93458	10.00401	10.07344	10.14287	10.2123	10.30803	10.40376	10.49949	10.59522	10.69095	10.78668	10.88241	10.97814	11.07387	11.1696	11.20631	11.24302	11.27973	11.31644	11.35315	11.38986	11.42657	11.46328	11.49999	11.5367	11.51102	11.48534	11.45966	11.43398	11.4083	11.38262	11.35694	11.33126	11.30558	11.2799	11.11044	10.94098	10.77152	10.60206	10.4326	10.26314	10.09368	9.92422	9.75476	9.5853	9.34897	9.11264	8.87631	8.63998	8.40365	8.16732	7.93099	7.69466	7.45833	7.222	6.91879	6.61558	6.31237	6.00916	5.70595	5.40274	5.09953	4.79632	4.49311	4.1899	4.19287	4.19584	4.19881	4.20178	4.20475	4.20772	4.21069	4.21366	4.21663	4.2196	4.22257	4.22554	4.22851	4.23148	4.23445	4.23742	4.24039	4.24336	4.24633	4.2493	4.13531	4.02132	3.90733	3.79334	3.67935	3.56536	3.45137	3.33738	3.22339	3.1094	3.02783	2.94626	2.86469	2.78312	2.70155	2.61998	2.53841	2.45684	2.37527	2.2937	2.26073	2.22776	2.19479	2.16182	2.12885	2.09588	2.06291	2.02994	1.99697	1.964	1.93853	1.91306	1.88759	1.86212	1.83665	1.81118	1.78571	1.76024	1.73477	1.7093	1.6831375	1.656975	1.6308125	1.60465	1.5784875	1.552325	1.5261625	1.5	1.5354	1.5468	1.5531	1.5547	1.5527	1.5482	1.5419	1.5324	1.5229	1.5134	1.5039	1.4944	1.48311	1.47182	1.46053	1.44924	1.43795	1.42666	1.41537	1.40408	1.39279	1.3815	1.3712	1.3609	1.3506	1.3403	1.33	1.3197	1.3094	1.2991	1.2888	1.2785	1.26966	1.26082	1.25198	1.24314	1.2343	1.22546	1.21662	1.20778	1.19894	1.1901	1.18257	1.17504	1.16751	1.15998	1.15245	1.14492	1.13739	1.12986	1.12233	1.1148	1.10836	1.10192	1.09548	1.08904	1.0826	1.07616	1.06972	1.06328	1.05684	1.0504	1.04486	1.03932	1.03378	1.02824	1.0227	1.01716	1.01162	1.00608	1.00054	0.995	0.99023	0.98546	0.98069	0.97592	0.97115	0.96638	0.96161	0.95684	0.95207	0.9473	0.94314	0.93898	0.93482	0.93066	0.9265	0.92234	0.91818	0.91402	0.90986	0.9057	0.90206	0.89842	0.89478	0.89114	0.8875	0.88386	0.88022	0.87658	0.87294	0.8693	0.8661	0.8629	0.8597	0.8565	0.8533	0.8501	0.8469	0.8437	0.8405	0.8373	0.83445	0.8316	0.82875	0.8259	0.82305	0.8202	0.81735	0.8145	0.81165	0.8088	0.80629	0.80378	0.80127	0.79876	0.79625	0.79374	0.79123	0.78872	0.78621	0.7837	0.78142	0.77914	0.77686	0.77458	0.7723	0.77002	0.76774	0.76546	0.76318	0.7609	0.75884	0.75678	0.75472	0.75266	0.7506	0.74854	0.74648	0.74442	0.74236	0.7403	0.738714	0.737128	0.735542	0.733956	0.73237	0.730784	0.729198	0.727612	0.726026	0.72444	0.722854	0.721268	0.719682	0.718096	0.71651	0.714924	0.713338	0.711752	0.710166	0.70858	0.706994	0.705408	0.703822	0.702236	0.70065	0.699064	0.697478	0.695892	0.694306	0.69272	0.691134	0.689548	0.687962	0.686376	0.68479	0.683204	0.681618	0.680032	0.678446	0.67686	0.675274	0.673688	0.672102	0.670516	0.66893	0.667344	0.665758	0.664172	0.662586	0.661	0.659886	0.658772	0.657658	0.656544	0.65543	0.654316	0.653202	0.652088	0.650974	0.64986	0.648746	0.647632	0.646518	0.645404	0.64429	0.643176	0.642062	0.640948	0.639834	0.63872	0.637606	0.636492	0.635378	0.634264	0.63315	0.632036	0.630922	0.629808	0.628694	0.62758	0.626466	0.625352	0.624238	0.623124	0.62201	0.620896	0.619782	0.618668	0.617554	0.61644	0.615326	0.614212	0.613098	0.611984	0.61087	0.609756	0.608642	0.607528	0.606414	0.6053	0.604434	0.603568	0.602702	0.601836	0.60097	0.600104	0.599238	0.598372	0.597506	0.59664	0.595774	0.594908	0.594042	0.593176	0.59231	0.591444	0.590578	0.589712	0.588846	0.58798	0.587114	0.586248	0.585382	0.584516	0.58365	0.582784	0.581918	0.581052	0.580186	0.57932	0.578454	0.577588	0.576722	0.575856	0.57499	0.574124	0.573258	0.572392	0.571526	0.57066	0.569794	0.568928	0.568062	0.567196	0.56633	0.565464	0.564598	0.563732	0.562866	0.562	0.56425	0.5665	0.56875	0.571	0.57325	0.5755	0.57775	0.58	0.58225	0.5845	0.58675	0.589	0.59125	0.5935	0.59575	0.598	0.60025	0.6025	0.60475	0.607	0.60925	0.6115	0.61375	0.616	0.61825	0.6205	0.62275	0.625	0.62725	0.6295	0.63175	0.634	0.63625	0.6385	0.64075	0.643	0.64525	0.6475	0.64975	0.652	0.65425	0.6565	0.65875	0.661	0.66325	0.6655	0.66775	0.67	0.67225	0.6745]; % Example function
CO2ConcRCP45 =	[278.05158	278.10615	278.22039	278.34305	278.47058	278.60047	278.73275	278.86881	279.00907	279.15318	279.3018	279.4568	279.61808	279.78192	279.9432	280.0974	280.2428	280.38168	280.51832	280.6572	280.8026	280.9568	281.11808	281.28192	281.4432	281.5982	281.74682	281.89093	282.03119	282.16725	282.29901	282.4268	282.55093	282.67123	282.7873	282.89901	283.00677	283.11093	283.21129	283.30737	283.39963	283.48978	283.57796	283.66116	283.73511	283.79676	283.84667	283.88853	283.92613	283.96267	284.00107	284.04267	284.08613	284.12853	284.16667	284.1982	284.22333	284.24427	284.26307	284.28133	284.30027	284.32	284.34	284.36	284.38	284.4	284.385	284.28	284.125	283.975	283.825	283.675	283.525	283.425	283.4	283.4	283.425	283.5	283.6	283.725	283.9	284.075	284.225	284.4	284.575	284.725	284.875	285	285.125	285.275	285.425	285.575	285.725	285.9	286.075	286.225	286.375	286.5	286.625	286.775	286.9	287	287.1	287.225	287.375	287.525	287.7	287.9	288.125	288.4	288.7	289.025	289.4	289.8	290.225	290.7	291.2	291.675	292.125	292.575	292.975	293.3	293.575	293.8	294	294.175	294.325	294.475	294.6	294.7	294.8	294.9	295.025	295.225	295.5	295.8	296.125	296.475	296.825	297.2	297.625	298.075	298.5	298.9	299.3	299.7	300.075	300.425	300.775	301.1	301.4	301.725	302.075	302.4	302.7	303.025	303.4	303.775	304.125	304.525	304.975	305.4	305.825	306.3	306.775	307.225	307.7	308.175	308.6	309	309.4	309.75	310	310.175	310.3	310.375	310.375	310.3	310.2	310.125	310.1	310.125	310.2	310.325	310.5	310.75	311.1	311.5	311.925	312.425	313	313.6	314.225	314.8475	315.5	316.2725	317.075	317.795	318.3975	318.925	319.6475	320.6475	321.605	322.635	323.9025	324.985	325.855	327.14	328.6775	329.7425	330.585	331.7475	333.2725	334.8475	336.525	338.36	339.7275	340.7925	342.1975	343.7825	345.2825	346.7975	348.645	350.7375	352.4875	353.855	355.0175	355.885	356.7775	358.1275	359.8375	361.4625	363.155	365.3225	367.3475	368.865	370.4675	372.5225	374.76	376.8125	378.8125	380.8275	382.7775	384.8	386.9516	389.12785	391.27357	393.4211	395.58283	397.76408	399.96631	402.18432	404.41077	406.64292	408.8817	411.12868	413.37804	415.63944	417.93551	420.27395	422.65593	425.07983	427.53791	430.0206	432.5234	435.04594	437.58886	440.13137	442.66419	445.20699	447.76978	450.35539	452.96337	455.58649	458.2152	460.84499	463.47549	466.09336	468.67807	471.23389	473.78031	476.32819	478.88085	481.43826	483.99308	486.53532	489.06035	491.53558	493.93186	496.24365	498.47436	500.64502	502.76788	504.84729	506.88408	508.87135	510.79905	512.64717	514.40151	516.06461	517.62854	519.09606	520.48828	521.81772	523.08871	524.30217	525.45089	526.50901	527.45707	528.29593	529.02718	529.64253	530.14419	530.55341	530.88313	531.13797	531.31935	531.48991	531.70213	531.94208	532.20472	532.48672	532.77553	533.06978	533.38792	533.74072	534.13086	534.55754	535.01142	535.47962	535.95487	536.4351	536.91986	537.39855	537.87136	538.3583	538.8715	539.38819	539.88381	540.35213	540.78203	541.16804	541.50962	541.80769	542.05261	542.24555	542.40767	542.55941	542.71221	542.86612	543.01262	543.13926	543.23925	543.31105	543.35475	543.35993	543.32712	543.28815	543.26597	543.26382	543.28162	543.31031	543.337	543.35452	543.36102	543.35628	543.32954	543.28277	543.23814	543.20814	543.19691	543.20476	543.22301	543.23901	543.2458	543.24169	543.22663	543.18977	543.13128	543.07193	543.02451	542.9934	542.97911	542.97309	542.96279	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532];

A = [0.113 0.213 0.258 0.273 0.1430];
tau = [2.0 12.2 50.4 243.3 inf];
tspan=1:numel(U);
k = 3.06*10^(-3);
M_0 = 600;
alpha21 = 15/600;
alpha23 = 45/600;
alpha31 = 45/1500;
beta = 0.1:0.1:0.8;

dt=1;

NPP=@(B1,beta) 60*(1+beta*log(B1/600));  %Function
dB_1=@(t,B1,B2,B3,beta) alpha31*B3+alpha21*B2-NPP(B1, beta)+U(t);  %Function
dB_2=@(t,B1,B2,B3,beta) NPP(B1, beta)-alpha23*B2-alpha21*B2;       %Function
dB_3=@(t,B1,B2,B3,beta)alpha23*B2-alpha31*B3;                %Function  

for r=1:length(beta)
%Dummy vector to store CO2 amount.
B_1=zeros(1,length(U));
B_2=zeros(1,length(U));
B_3=zeros(1,length(U));

B_1(1) = 600; 
B_2(1) = 600; 
B_3(1) = 1500;


M=zeros(1,length(tspan));
utslapp_ant = zeros(1,length(tspan)-1 );
M(1)=M_0;

for t=1:length(tspan)-1
    sum_M=0;
    utslapp_ant(t) = dB_1(t, B_1(t), B_2(t), B_3(t), beta(r));
    
    for t_hat=1:t
        sum_I = 0;
        tau_i = tau .* (1 + k .* sum(utslapp_ant(1:t-1)) );
        for i = 1:length(A)
            sum_I = sum_I + A(i) .* exp(-(t - t_hat) ./ tau_i(i) );
        end
        sum_M=sum_M+sum_I*utslapp_ant(t_hat);
    end
    M(t+1)=M_0+sum_M;

    %Euler Forward Method to iteratively fill the B vectors.
    B_1(1,t + dt) = M(t);
    B_2(1,t + dt) = B_2(t) + dB_2(t, B_1(t), B_2(t), B_3(t), beta(r))*dt;
    B_3(1,t + dt) = B_3(t) + dB_3(t, B_1(t), B_2(t), B_3(t), beta(r))*dt;

end

hold on;
plot(tspan,0.469*B_1(1,:))
hold on;
end
hold on;
plot(tspan,CO2ConcRCP45)

%% Uppgift 7a

U= [0.003	0.008338296	0.013676593	0.019014889	0.024353185	0.029691482	0.036029778	0.041368074	0.046706371	0.052044667	0.057382963	0.062721259	0.068059556	0.073397852	0.078736148	0.084074445	0.090412741	0.095751037	0.101089334	0.10642763	0.11176593	0.11710422	0.12244252	0.12778082	0.13311911	0.13845741	0.1447957	0.150134	0.1554723	0.16081059	0.16614889	0.17148719	0.17782548	0.18316378	0.18850207	0.19484037	0.20017867	0.20751696	0.21185526	0.21719356	0.22253185	0.22887015	0.23420845	0.23954674	0.24488504	0.25022333	0.25656163	0.26189993	0.26723822	0.27257652	0.27891482	0.28525311	0.29159141	0.2969297	0.302268	0.3076063	0.31294459	0.31928289	0.32562119	0.33095948	0.33729778	0.34263608	0.34897437	0.35431267	0.35965096	0.37098926	0.37532756	0.38066585	0.38700415	0.39234245	0.39868074	0.40801904	0.41335733	0.41969563	0.42603393	0.433372219	0.439710519	0.447048819	0.453387109	0.460725409	0.470063709	0.475401999	0.483740299	0.490078589	0.498416889	0.507755189	0.500785689	0.555622819	0.556354489	0.564817079	0.564679249	0.574934879	0.581231999	0.587232979	0.597253889	0.609966889	0.623223598	0.570716628	0.57774912	0.58613825	0.59379536	0.59691218	0.60360622	0.6072347	0.61276645	0.6166445	0.64366524	0.7403334	0.76129965	0.75771154	0.77842647	0.78787801	0.79713853	0.8050507	0.82534752	0.85724317	0.89187292	0.86066403	0.88051762	0.88712775	0.8922361	0.89814412	0.91116314	0.94173355	0.94020019	0.96775411	0.98224854	0.99719118	0.9944033	1.02336718	1.0504185	1.06527839	1.08956411	1.11600097	1.15920445	1.18720627	1.25494317	1.26897363	1.34367095	1.37229323	1.4328152	1.50353383	1.58776273	1.56141277	1.60237806	1.64098168	1.61489404	1.62684843	1.66597976	1.56479151	1.54374963	1.60911647	1.66619629	1.65030426	1.52565434	1.65328337	1.5604166	1.59294089	1.72328818	1.71986058	1.73308854	1.74448326	1.85918283	1.86467141	1.96922601	1.94887975	1.84334081	1.65922596	1.70158848	1.76986255	1.82171575	1.93129993	1.98869902	1.92388222	1.97144376	2.06583237	2.08436458	2.1110497	2.1547656	2.15139864	1.92914739	2.08014892	2.26217994	2.34413044	2.30112641	2.52233465	2.8565201	2.9056378	2.9455171	3.0171416	3.2341855	3.4226883	3.5418718	3.6495817	3.6655957	3.7692833	3.8383218	3.9355717	4.0922947	4.2595879	4.4092558	4.5986968	4.7086254	4.8232028	5.0383879	5.2731129	5.3018913	5.4460621	5.6680986	5.6827371	5.6465876	5.9736077	6.1229874	6.19537	6.4517127	6.3572096	6.2128621	6.3174055	6.3355201	6.5500833	6.7193449	6.8972023	7.0470086	7.2807248	7.4126436	7.4634833	7.6159799	7.4215304	7.4221006	7.5315956	7.6470104	7.7611025	7.8371397	7.8028431	7.7517892	7.8838	8.0279	8.1807	8.5117	8.9148	9.1665	9.237	9.3075	9.3776666	9.44783337	9.518	9.58743	9.65686	9.72629	9.79572	9.86515	9.93458	10.00401	10.07344	10.14287	10.2123	10.30803	10.40376	10.49949	10.59522	10.69095	10.78668	10.88241	10.97814	11.07387	11.1696	11.20631	11.24302	11.27973	11.31644	11.35315	11.38986	11.42657	11.46328	11.49999	11.5367	11.51102	11.48534	11.45966	11.43398	11.4083	11.38262	11.35694	11.33126	11.30558	11.2799	11.11044	10.94098	10.77152	10.60206	10.4326	10.26314	10.09368	9.92422	9.75476	9.5853	9.34897	9.11264	8.87631	8.63998	8.40365	8.16732	7.93099	7.69466	7.45833	7.222	6.91879	6.61558	6.31237	6.00916	5.70595	5.40274	5.09953	4.79632	4.49311	4.1899	4.19287	4.19584	4.19881	4.20178	4.20475	4.20772	4.21069	4.21366	4.21663	4.2196	4.22257	4.22554	4.22851	4.23148	4.23445	4.23742	4.24039	4.24336	4.24633	4.2493	4.13531	4.02132	3.90733	3.79334	3.67935	3.56536	3.45137	3.33738	3.22339	3.1094	3.02783	2.94626	2.86469	2.78312	2.70155	2.61998	2.53841	2.45684	2.37527	2.2937	2.26073	2.22776	2.19479	2.16182	2.12885	2.09588	2.06291	2.02994	1.99697	1.964	1.93853	1.91306	1.88759	1.86212	1.83665	1.81118	1.78571	1.76024	1.73477	1.7093	1.6831375	1.656975	1.6308125	1.60465	1.5784875	1.552325	1.5261625	1.5	1.5354	1.5468	1.5531	1.5547	1.5527	1.5482	1.5419	1.5324	1.5229	1.5134	1.5039	1.4944	1.48311	1.47182	1.46053	1.44924	1.43795	1.42666	1.41537	1.40408	1.39279	1.3815	1.3712	1.3609	1.3506	1.3403	1.33	1.3197	1.3094	1.2991	1.2888	1.2785	1.26966	1.26082	1.25198	1.24314	1.2343	1.22546	1.21662	1.20778	1.19894	1.1901	1.18257	1.17504	1.16751	1.15998	1.15245	1.14492	1.13739	1.12986	1.12233	1.1148	1.10836	1.10192	1.09548	1.08904	1.0826	1.07616	1.06972	1.06328	1.05684	1.0504	1.04486	1.03932	1.03378	1.02824	1.0227	1.01716	1.01162	1.00608	1.00054	0.995	0.99023	0.98546	0.98069	0.97592	0.97115	0.96638	0.96161	0.95684	0.95207	0.9473	0.94314	0.93898	0.93482	0.93066	0.9265	0.92234	0.91818	0.91402	0.90986	0.9057	0.90206	0.89842	0.89478	0.89114	0.8875	0.88386	0.88022	0.87658	0.87294	0.8693	0.8661	0.8629	0.8597	0.8565	0.8533	0.8501	0.8469	0.8437	0.8405	0.8373	0.83445	0.8316	0.82875	0.8259	0.82305	0.8202	0.81735	0.8145	0.81165	0.8088	0.80629	0.80378	0.80127	0.79876	0.79625	0.79374	0.79123	0.78872	0.78621	0.7837	0.78142	0.77914	0.77686	0.77458	0.7723	0.77002	0.76774	0.76546	0.76318	0.7609	0.75884	0.75678	0.75472	0.75266	0.7506	0.74854	0.74648	0.74442	0.74236	0.7403	0.738714	0.737128	0.735542	0.733956	0.73237	0.730784	0.729198	0.727612	0.726026	0.72444	0.722854	0.721268	0.719682	0.718096	0.71651	0.714924	0.713338	0.711752	0.710166	0.70858	0.706994	0.705408	0.703822	0.702236	0.70065	0.699064	0.697478	0.695892	0.694306	0.69272	0.691134	0.689548	0.687962	0.686376	0.68479	0.683204	0.681618	0.680032	0.678446	0.67686	0.675274	0.673688	0.672102	0.670516	0.66893	0.667344	0.665758	0.664172	0.662586	0.661	0.659886	0.658772	0.657658	0.656544	0.65543	0.654316	0.653202	0.652088	0.650974	0.64986	0.648746	0.647632	0.646518	0.645404	0.64429	0.643176	0.642062	0.640948	0.639834	0.63872	0.637606	0.636492	0.635378	0.634264	0.63315	0.632036	0.630922	0.629808	0.628694	0.62758	0.626466	0.625352	0.624238	0.623124	0.62201	0.620896	0.619782	0.618668	0.617554	0.61644	0.615326	0.614212	0.613098	0.611984	0.61087	0.609756	0.608642	0.607528	0.606414	0.6053	0.604434	0.603568	0.602702	0.601836	0.60097	0.600104	0.599238	0.598372	0.597506	0.59664	0.595774	0.594908	0.594042	0.593176	0.59231	0.591444	0.590578	0.589712	0.588846	0.58798	0.587114	0.586248	0.585382	0.584516	0.58365	0.582784	0.581918	0.581052	0.580186	0.57932	0.578454	0.577588	0.576722	0.575856	0.57499	0.574124	0.573258	0.572392	0.571526	0.57066	0.569794	0.568928	0.568062	0.567196	0.56633	0.565464	0.564598	0.563732	0.562866	0.562	0.56425	0.5665	0.56875	0.571	0.57325	0.5755	0.57775	0.58	0.58225	0.5845	0.58675	0.589	0.59125	0.5935	0.59575	0.598	0.60025	0.6025	0.60475	0.607	0.60925	0.6115	0.61375	0.616	0.61825	0.6205	0.62275	0.625	0.62725	0.6295	0.63175	0.634	0.63625	0.6385	0.64075	0.643	0.64525	0.6475	0.64975	0.652	0.65425	0.6565	0.65875	0.661	0.66325	0.6655	0.66775	0.67	0.67225	0.6745]; % Example function
CO2ConcRCP45 =	[278.05158	278.10615	278.22039	278.34305	278.47058	278.60047	278.73275	278.86881	279.00907	279.15318	279.3018	279.4568	279.61808	279.78192	279.9432	280.0974	280.2428	280.38168	280.51832	280.6572	280.8026	280.9568	281.11808	281.28192	281.4432	281.5982	281.74682	281.89093	282.03119	282.16725	282.29901	282.4268	282.55093	282.67123	282.7873	282.89901	283.00677	283.11093	283.21129	283.30737	283.39963	283.48978	283.57796	283.66116	283.73511	283.79676	283.84667	283.88853	283.92613	283.96267	284.00107	284.04267	284.08613	284.12853	284.16667	284.1982	284.22333	284.24427	284.26307	284.28133	284.30027	284.32	284.34	284.36	284.38	284.4	284.385	284.28	284.125	283.975	283.825	283.675	283.525	283.425	283.4	283.4	283.425	283.5	283.6	283.725	283.9	284.075	284.225	284.4	284.575	284.725	284.875	285	285.125	285.275	285.425	285.575	285.725	285.9	286.075	286.225	286.375	286.5	286.625	286.775	286.9	287	287.1	287.225	287.375	287.525	287.7	287.9	288.125	288.4	288.7	289.025	289.4	289.8	290.225	290.7	291.2	291.675	292.125	292.575	292.975	293.3	293.575	293.8	294	294.175	294.325	294.475	294.6	294.7	294.8	294.9	295.025	295.225	295.5	295.8	296.125	296.475	296.825	297.2	297.625	298.075	298.5	298.9	299.3	299.7	300.075	300.425	300.775	301.1	301.4	301.725	302.075	302.4	302.7	303.025	303.4	303.775	304.125	304.525	304.975	305.4	305.825	306.3	306.775	307.225	307.7	308.175	308.6	309	309.4	309.75	310	310.175	310.3	310.375	310.375	310.3	310.2	310.125	310.1	310.125	310.2	310.325	310.5	310.75	311.1	311.5	311.925	312.425	313	313.6	314.225	314.8475	315.5	316.2725	317.075	317.795	318.3975	318.925	319.6475	320.6475	321.605	322.635	323.9025	324.985	325.855	327.14	328.6775	329.7425	330.585	331.7475	333.2725	334.8475	336.525	338.36	339.7275	340.7925	342.1975	343.7825	345.2825	346.7975	348.645	350.7375	352.4875	353.855	355.0175	355.885	356.7775	358.1275	359.8375	361.4625	363.155	365.3225	367.3475	368.865	370.4675	372.5225	374.76	376.8125	378.8125	380.8275	382.7775	384.8	386.9516	389.12785	391.27357	393.4211	395.58283	397.76408	399.96631	402.18432	404.41077	406.64292	408.8817	411.12868	413.37804	415.63944	417.93551	420.27395	422.65593	425.07983	427.53791	430.0206	432.5234	435.04594	437.58886	440.13137	442.66419	445.20699	447.76978	450.35539	452.96337	455.58649	458.2152	460.84499	463.47549	466.09336	468.67807	471.23389	473.78031	476.32819	478.88085	481.43826	483.99308	486.53532	489.06035	491.53558	493.93186	496.24365	498.47436	500.64502	502.76788	504.84729	506.88408	508.87135	510.79905	512.64717	514.40151	516.06461	517.62854	519.09606	520.48828	521.81772	523.08871	524.30217	525.45089	526.50901	527.45707	528.29593	529.02718	529.64253	530.14419	530.55341	530.88313	531.13797	531.31935	531.48991	531.70213	531.94208	532.20472	532.48672	532.77553	533.06978	533.38792	533.74072	534.13086	534.55754	535.01142	535.47962	535.95487	536.4351	536.91986	537.39855	537.87136	538.3583	538.8715	539.38819	539.88381	540.35213	540.78203	541.16804	541.50962	541.80769	542.05261	542.24555	542.40767	542.55941	542.71221	542.86612	543.01262	543.13926	543.23925	543.31105	543.35475	543.35993	543.32712	543.28815	543.26597	543.26382	543.28162	543.31031	543.337	543.35452	543.36102	543.35628	543.32954	543.28277	543.23814	543.20814	543.19691	543.20476	543.22301	543.23901	543.2458	543.24169	543.22663	543.18977	543.13128	543.07193	543.02451	542.9934	542.97911	542.97309	542.96279	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532];

A = [0.113 0.213 0.258 0.273 0.1430];
tau = [2.0 12.2 50.4 243.3 inf];
tspan=1:numel(U);
k = 3.06*10^(-3);
%k = (15:5:60) .*10^(-3);
M_0 = 600;
alpha21 = 15/600;
alpha23 = 45/600;
alpha31 = 45/1500;
beta = [0.35/2 0.35 0.7];

dt=1;

NPP=@(B1,beta) 60*(1+beta*log(B1/600));  %Function
dB_1=@(t,B1,B2,B3,beta) alpha31*B3+alpha21*B2-NPP(B1, beta)+U(t);  %Function
dB_2=@(t,B1,B2,B3,beta) NPP(B1, beta)-alpha23*B2-alpha21*B2;       %Function
dB_3=@(t,B1,B2,B3,beta)alpha23*B2-alpha31*B3;                %Function  


for r=1:length(beta)
%Dummy vector to store CO2 amount.
B_1=zeros(1,length(U));
B_2=zeros(1,length(U));
B_3=zeros(1,length(U));
B_4=zeros(1,length(U));

B_1(1) = 600; 
B_2(1) = 600; 
B_3(1) = 1500;
B_4(1)=0;


M=zeros(1,length(tspan));
utslapp_ant = zeros(1,length(tspan)-1 );
M(1)=M_0;


figure(1);
hold on;

figure(2);
hold on;

figure(3);
hold on;

figure(4);
hold on;


for t=1:length(tspan)-1
    sum_M=0;
    utslapp_ant(t) = dB_1(t, B_1(t), B_2(t), B_3(t), beta(r));
    
    for t_hat=1:t
        
        sum_I = 0;
        tau_i = tau .* (1 + k .* sum(utslapp_ant(1:t-1)) );
        for i = 1:length(A)
            sum_I = sum_I + A(i) .* exp(-(t - t_hat) ./ tau_i(i) );
        end
        sum_M=sum_M+sum_I*utslapp_ant(t_hat);
    end
    M(t)=M_0+sum_M;

    %Euler Forward Method to iteratively fill the B vectors.
    B_1(1,t + dt) = M(t);
    B_2(1,t + dt) = B_2(t) + dB_2(t, B_1(t), B_2(t), B_3(t), beta(r))*dt;
    B_3(1,t + dt) = B_3(t) + dB_3(t, B_1(t), B_2(t), B_3(t), beta(r))*dt;
    B_4(1,t + dt) = sum(U(1:t)) + B_1(1) + B_2(1) + B_3(1) -  B_1(t) + B_2(t) + B_3(t);

    
end

hold on;
figure(1);
plot(tspan(1:335),0.469*B_1(1,1:335), "LineWidth",2)

figure(2);
plot(tspan(1:335),0.469*B_2(1,1:335), "LineWidth",2)

figure(3);
plot(tspan(1:335),0.469*B_3(1,1:335), "LineWidth",2)

figure(4);
plot(tspan(1:335), 0.469*B_4(1,1:335) , "LineWidth", 2)

hold on;
end
hold on;

figure(1);
plot(tspan(1:335),CO2ConcRCP45(1:335))
legend("beta_1", "beta_2", "beta_3", "Reference" )

figure(2);
legend("beta_1", "beta_2", "beta_3")

figure(3);
legend("beta_1", "beta_2", "beta_3")

figure(4);
legend("k_1", "k_2", "k_3")
%% Uppgift 7b


U= [0.003	0.008338296	0.013676593	0.019014889	0.024353185	0.029691482	0.036029778	0.041368074	0.046706371	0.052044667	0.057382963	0.062721259	0.068059556	0.073397852	0.078736148	0.084074445	0.090412741	0.095751037	0.101089334	0.10642763	0.11176593	0.11710422	0.12244252	0.12778082	0.13311911	0.13845741	0.1447957	0.150134	0.1554723	0.16081059	0.16614889	0.17148719	0.17782548	0.18316378	0.18850207	0.19484037	0.20017867	0.20751696	0.21185526	0.21719356	0.22253185	0.22887015	0.23420845	0.23954674	0.24488504	0.25022333	0.25656163	0.26189993	0.26723822	0.27257652	0.27891482	0.28525311	0.29159141	0.2969297	0.302268	0.3076063	0.31294459	0.31928289	0.32562119	0.33095948	0.33729778	0.34263608	0.34897437	0.35431267	0.35965096	0.37098926	0.37532756	0.38066585	0.38700415	0.39234245	0.39868074	0.40801904	0.41335733	0.41969563	0.42603393	0.433372219	0.439710519	0.447048819	0.453387109	0.460725409	0.470063709	0.475401999	0.483740299	0.490078589	0.498416889	0.507755189	0.500785689	0.555622819	0.556354489	0.564817079	0.564679249	0.574934879	0.581231999	0.587232979	0.597253889	0.609966889	0.623223598	0.570716628	0.57774912	0.58613825	0.59379536	0.59691218	0.60360622	0.6072347	0.61276645	0.6166445	0.64366524	0.7403334	0.76129965	0.75771154	0.77842647	0.78787801	0.79713853	0.8050507	0.82534752	0.85724317	0.89187292	0.86066403	0.88051762	0.88712775	0.8922361	0.89814412	0.91116314	0.94173355	0.94020019	0.96775411	0.98224854	0.99719118	0.9944033	1.02336718	1.0504185	1.06527839	1.08956411	1.11600097	1.15920445	1.18720627	1.25494317	1.26897363	1.34367095	1.37229323	1.4328152	1.50353383	1.58776273	1.56141277	1.60237806	1.64098168	1.61489404	1.62684843	1.66597976	1.56479151	1.54374963	1.60911647	1.66619629	1.65030426	1.52565434	1.65328337	1.5604166	1.59294089	1.72328818	1.71986058	1.73308854	1.74448326	1.85918283	1.86467141	1.96922601	1.94887975	1.84334081	1.65922596	1.70158848	1.76986255	1.82171575	1.93129993	1.98869902	1.92388222	1.97144376	2.06583237	2.08436458	2.1110497	2.1547656	2.15139864	1.92914739	2.08014892	2.26217994	2.34413044	2.30112641	2.52233465	2.8565201	2.9056378	2.9455171	3.0171416	3.2341855	3.4226883	3.5418718	3.6495817	3.6655957	3.7692833	3.8383218	3.9355717	4.0922947	4.2595879	4.4092558	4.5986968	4.7086254	4.8232028	5.0383879	5.2731129	5.3018913	5.4460621	5.6680986	5.6827371	5.6465876	5.9736077	6.1229874	6.19537	6.4517127	6.3572096	6.2128621	6.3174055	6.3355201	6.5500833	6.7193449	6.8972023	7.0470086	7.2807248	7.4126436	7.4634833	7.6159799	7.4215304	7.4221006	7.5315956	7.6470104	7.7611025	7.8371397	7.8028431	7.7517892	7.8838	8.0279	8.1807	8.5117	8.9148	9.1665	9.237	9.3075	9.3776666	9.44783337	9.518	9.58743	9.65686	9.72629	9.79572	9.86515	9.93458	10.00401	10.07344	10.14287	10.2123	10.30803	10.40376	10.49949	10.59522	10.69095	10.78668	10.88241	10.97814	11.07387	11.1696	11.20631	11.24302	11.27973	11.31644	11.35315	11.38986	11.42657	11.46328	11.49999	11.5367	11.51102	11.48534	11.45966	11.43398	11.4083	11.38262	11.35694	11.33126	11.30558	11.2799	11.11044	10.94098	10.77152	10.60206	10.4326	10.26314	10.09368	9.92422	9.75476	9.5853	9.34897	9.11264	8.87631	8.63998	8.40365	8.16732	7.93099	7.69466	7.45833	7.222	6.91879	6.61558	6.31237	6.00916	5.70595	5.40274	5.09953	4.79632	4.49311	4.1899	4.19287	4.19584	4.19881	4.20178	4.20475	4.20772	4.21069	4.21366	4.21663	4.2196	4.22257	4.22554	4.22851	4.23148	4.23445	4.23742	4.24039	4.24336	4.24633	4.2493	4.13531	4.02132	3.90733	3.79334	3.67935	3.56536	3.45137	3.33738	3.22339	3.1094	3.02783	2.94626	2.86469	2.78312	2.70155	2.61998	2.53841	2.45684	2.37527	2.2937	2.26073	2.22776	2.19479	2.16182	2.12885	2.09588	2.06291	2.02994	1.99697	1.964	1.93853	1.91306	1.88759	1.86212	1.83665	1.81118	1.78571	1.76024	1.73477	1.7093	1.6831375	1.656975	1.6308125	1.60465	1.5784875	1.552325	1.5261625	1.5	1.5354	1.5468	1.5531	1.5547	1.5527	1.5482	1.5419	1.5324	1.5229	1.5134	1.5039	1.4944	1.48311	1.47182	1.46053	1.44924	1.43795	1.42666	1.41537	1.40408	1.39279	1.3815	1.3712	1.3609	1.3506	1.3403	1.33	1.3197	1.3094	1.2991	1.2888	1.2785	1.26966	1.26082	1.25198	1.24314	1.2343	1.22546	1.21662	1.20778	1.19894	1.1901	1.18257	1.17504	1.16751	1.15998	1.15245	1.14492	1.13739	1.12986	1.12233	1.1148	1.10836	1.10192	1.09548	1.08904	1.0826	1.07616	1.06972	1.06328	1.05684	1.0504	1.04486	1.03932	1.03378	1.02824	1.0227	1.01716	1.01162	1.00608	1.00054	0.995	0.99023	0.98546	0.98069	0.97592	0.97115	0.96638	0.96161	0.95684	0.95207	0.9473	0.94314	0.93898	0.93482	0.93066	0.9265	0.92234	0.91818	0.91402	0.90986	0.9057	0.90206	0.89842	0.89478	0.89114	0.8875	0.88386	0.88022	0.87658	0.87294	0.8693	0.8661	0.8629	0.8597	0.8565	0.8533	0.8501	0.8469	0.8437	0.8405	0.8373	0.83445	0.8316	0.82875	0.8259	0.82305	0.8202	0.81735	0.8145	0.81165	0.8088	0.80629	0.80378	0.80127	0.79876	0.79625	0.79374	0.79123	0.78872	0.78621	0.7837	0.78142	0.77914	0.77686	0.77458	0.7723	0.77002	0.76774	0.76546	0.76318	0.7609	0.75884	0.75678	0.75472	0.75266	0.7506	0.74854	0.74648	0.74442	0.74236	0.7403	0.738714	0.737128	0.735542	0.733956	0.73237	0.730784	0.729198	0.727612	0.726026	0.72444	0.722854	0.721268	0.719682	0.718096	0.71651	0.714924	0.713338	0.711752	0.710166	0.70858	0.706994	0.705408	0.703822	0.702236	0.70065	0.699064	0.697478	0.695892	0.694306	0.69272	0.691134	0.689548	0.687962	0.686376	0.68479	0.683204	0.681618	0.680032	0.678446	0.67686	0.675274	0.673688	0.672102	0.670516	0.66893	0.667344	0.665758	0.664172	0.662586	0.661	0.659886	0.658772	0.657658	0.656544	0.65543	0.654316	0.653202	0.652088	0.650974	0.64986	0.648746	0.647632	0.646518	0.645404	0.64429	0.643176	0.642062	0.640948	0.639834	0.63872	0.637606	0.636492	0.635378	0.634264	0.63315	0.632036	0.630922	0.629808	0.628694	0.62758	0.626466	0.625352	0.624238	0.623124	0.62201	0.620896	0.619782	0.618668	0.617554	0.61644	0.615326	0.614212	0.613098	0.611984	0.61087	0.609756	0.608642	0.607528	0.606414	0.6053	0.604434	0.603568	0.602702	0.601836	0.60097	0.600104	0.599238	0.598372	0.597506	0.59664	0.595774	0.594908	0.594042	0.593176	0.59231	0.591444	0.590578	0.589712	0.588846	0.58798	0.587114	0.586248	0.585382	0.584516	0.58365	0.582784	0.581918	0.581052	0.580186	0.57932	0.578454	0.577588	0.576722	0.575856	0.57499	0.574124	0.573258	0.572392	0.571526	0.57066	0.569794	0.568928	0.568062	0.567196	0.56633	0.565464	0.564598	0.563732	0.562866	0.562	0.56425	0.5665	0.56875	0.571	0.57325	0.5755	0.57775	0.58	0.58225	0.5845	0.58675	0.589	0.59125	0.5935	0.59575	0.598	0.60025	0.6025	0.60475	0.607	0.60925	0.6115	0.61375	0.616	0.61825	0.6205	0.62275	0.625	0.62725	0.6295	0.63175	0.634	0.63625	0.6385	0.64075	0.643	0.64525	0.6475	0.64975	0.652	0.65425	0.6565	0.65875	0.661	0.66325	0.6655	0.66775	0.67	0.67225	0.6745]; % Example function
CO2ConcRCP45 =	[278.05158	278.10615	278.22039	278.34305	278.47058	278.60047	278.73275	278.86881	279.00907	279.15318	279.3018	279.4568	279.61808	279.78192	279.9432	280.0974	280.2428	280.38168	280.51832	280.6572	280.8026	280.9568	281.11808	281.28192	281.4432	281.5982	281.74682	281.89093	282.03119	282.16725	282.29901	282.4268	282.55093	282.67123	282.7873	282.89901	283.00677	283.11093	283.21129	283.30737	283.39963	283.48978	283.57796	283.66116	283.73511	283.79676	283.84667	283.88853	283.92613	283.96267	284.00107	284.04267	284.08613	284.12853	284.16667	284.1982	284.22333	284.24427	284.26307	284.28133	284.30027	284.32	284.34	284.36	284.38	284.4	284.385	284.28	284.125	283.975	283.825	283.675	283.525	283.425	283.4	283.4	283.425	283.5	283.6	283.725	283.9	284.075	284.225	284.4	284.575	284.725	284.875	285	285.125	285.275	285.425	285.575	285.725	285.9	286.075	286.225	286.375	286.5	286.625	286.775	286.9	287	287.1	287.225	287.375	287.525	287.7	287.9	288.125	288.4	288.7	289.025	289.4	289.8	290.225	290.7	291.2	291.675	292.125	292.575	292.975	293.3	293.575	293.8	294	294.175	294.325	294.475	294.6	294.7	294.8	294.9	295.025	295.225	295.5	295.8	296.125	296.475	296.825	297.2	297.625	298.075	298.5	298.9	299.3	299.7	300.075	300.425	300.775	301.1	301.4	301.725	302.075	302.4	302.7	303.025	303.4	303.775	304.125	304.525	304.975	305.4	305.825	306.3	306.775	307.225	307.7	308.175	308.6	309	309.4	309.75	310	310.175	310.3	310.375	310.375	310.3	310.2	310.125	310.1	310.125	310.2	310.325	310.5	310.75	311.1	311.5	311.925	312.425	313	313.6	314.225	314.8475	315.5	316.2725	317.075	317.795	318.3975	318.925	319.6475	320.6475	321.605	322.635	323.9025	324.985	325.855	327.14	328.6775	329.7425	330.585	331.7475	333.2725	334.8475	336.525	338.36	339.7275	340.7925	342.1975	343.7825	345.2825	346.7975	348.645	350.7375	352.4875	353.855	355.0175	355.885	356.7775	358.1275	359.8375	361.4625	363.155	365.3225	367.3475	368.865	370.4675	372.5225	374.76	376.8125	378.8125	380.8275	382.7775	384.8	386.9516	389.12785	391.27357	393.4211	395.58283	397.76408	399.96631	402.18432	404.41077	406.64292	408.8817	411.12868	413.37804	415.63944	417.93551	420.27395	422.65593	425.07983	427.53791	430.0206	432.5234	435.04594	437.58886	440.13137	442.66419	445.20699	447.76978	450.35539	452.96337	455.58649	458.2152	460.84499	463.47549	466.09336	468.67807	471.23389	473.78031	476.32819	478.88085	481.43826	483.99308	486.53532	489.06035	491.53558	493.93186	496.24365	498.47436	500.64502	502.76788	504.84729	506.88408	508.87135	510.79905	512.64717	514.40151	516.06461	517.62854	519.09606	520.48828	521.81772	523.08871	524.30217	525.45089	526.50901	527.45707	528.29593	529.02718	529.64253	530.14419	530.55341	530.88313	531.13797	531.31935	531.48991	531.70213	531.94208	532.20472	532.48672	532.77553	533.06978	533.38792	533.74072	534.13086	534.55754	535.01142	535.47962	535.95487	536.4351	536.91986	537.39855	537.87136	538.3583	538.8715	539.38819	539.88381	540.35213	540.78203	541.16804	541.50962	541.80769	542.05261	542.24555	542.40767	542.55941	542.71221	542.86612	543.01262	543.13926	543.23925	543.31105	543.35475	543.35993	543.32712	543.28815	543.26597	543.26382	543.28162	543.31031	543.337	543.35452	543.36102	543.35628	543.32954	543.28277	543.23814	543.20814	543.19691	543.20476	543.22301	543.23901	543.2458	543.24169	543.22663	543.18977	543.13128	543.07193	543.02451	542.9934	542.97911	542.97309	542.96279	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532];

A = [0.113 0.213 0.258 0.273 0.1430];
tau = [2.0 12.2 50.4 243.3 inf];
tspan=1:numel(U);
%k = 3.06*10^(-3);
k = [1.53 3.06 6.12] .*10^(-3);
M_0 = 600;
alpha21 = 15/600;
alpha23 = 45/600;
alpha31 = 45/1500;
beta = 0.35;

dt=1;

NPP=@(B1,beta) 60*(1+beta*log(B1/600));  %Function
dB_1=@(t,B1,B2,B3,beta) alpha31*B3+alpha21*B2-NPP(B1, beta)+U(t);  %Function
dB_2=@(t,B1,B2,B3,beta) NPP(B1, beta)-alpha23*B2-alpha21*B2;       %Function
dB_3=@(t,B1,B2,B3,beta)alpha23*B2-alpha31*B3;                %Function  


for s=1:length(k)
%Dummy vector to store CO2 amount.
B_1=zeros(1,length(U));
B_2=zeros(1,length(U));
B_3=zeros(1,length(U));
B_4=zeros(1,length(U));

B_1(1) = 600; 
B_2(1) = 600; 
B_3(1) = 1500;
B_4(1) = 0;

M=zeros(1,length(tspan));
utslapp_ant = zeros(1,length(tspan)-1 );
M(1)=M_0;


figure(1);
hold on;

figure(2);
hold on;

figure(3);
hold on;

figure(4);
hold on;

for t=1:length(tspan)-1
    sum_M=0;
    utslapp_ant(t) = dB_1(t, B_1(t), B_2(t), B_3(t), beta);
    
    for t_hat=1:t
        
        sum_I = 0;
        tau_i = tau .* (1 + k(s) .* sum(utslapp_ant(1:t-1)) );
        for i = 1:length(A)
            sum_I = sum_I + A(i) .* exp(-(t - t_hat) ./ tau_i(i) );
        end
        sum_M=sum_M+sum_I*utslapp_ant(t_hat);
    end
    M(t+1)=M_0+sum_M;

    %Euler Forward Method to iteratively fill the B vectors.
    B_1(1,t + dt) = M(t);
    B_2(1,t + dt) = B_2(t) + dB_2(t, B_1(t), B_2(t), B_3(t), beta)*dt;
    B_3(1,t + dt) = B_3(t) + dB_3(t, B_1(t), B_2(t), B_3(t), beta)*dt;
    B_4(1,t + dt) = sum(U(1:t)) + B_1(1) + B_2(1) + B_3(1) -  B_1(t) + B_2(t) + B_3(t);
    
end

hold on;
figure(1);
plot(tspan(1:335),0.469*B_1(1,1:335), "LineWidth",2)

figure(2);
plot(tspan(1:335),0.469*B_2(1,1:335), "LineWidth",2)

figure(3);
plot(tspan(1:335),0.469*B_3(1,1:335), "LineWidth",2)

figure(4);
plot(tspan(1:335), 0.469*B_4(1,1:335) , "LineWidth", 2)
 
hold on;
end
hold on;

figure(1);
plot(tspan(1:335),CO2ConcRCP45(1:335))
legend("k_1", "k_2", "k_3", "Reference" )

figure(2);
legend("k_1", "k_2", "k_3")

figure(3);
legend("k_1", "k_2", "k_3")

figure(4);
legend("k_1", "k_2", "k_3")



%k är mättnaden på havets förmåga att ta upp koldioxid.
%Därför resulterar ett litet värde på k i att havet tar upp mer.
%Detta leder i sin tur till att koldioxidhalten i resterande system
%minskar för små värden på k. Det stämmer överens med plottarna, där
%k_1 är minsta värdet på k och resulterar i minst mängd koldioxid i övriga
%systemet. 

%% Uppgift 8:
run('radiativeForcingRCP45.m') 
run('koncentrationerRCP45.m')


tspan=1:numel(U);

RF = @(U) 5.35 * log(U ./ (0.469 *600));

plot(tspan,CO2RadForc, 'LineWidth',2, 'LineStyle','--')
hold on;
plot(tspan,RF(CO2ConcRCP45),'LineWidth',2)
legend("Reference", "Radiative Forcing")

%% Uppgift 9

run('radiativeForcingRCP45.m') 
run('koncentrationerRCP45.m') 
s = 1;
Tot_Rad = CO2RadForc + totRadForcExclCO2AndAerosols*s + totRadForcAerosols*s;

U= [0.003	0.008338296	0.013676593	0.019014889	0.024353185	0.029691482	0.036029778	0.041368074	0.046706371	0.052044667	0.057382963	0.062721259	0.068059556	0.073397852	0.078736148	0.084074445	0.090412741	0.095751037	0.101089334	0.10642763	0.11176593	0.11710422	0.12244252	0.12778082	0.13311911	0.13845741	0.1447957	0.150134	0.1554723	0.16081059	0.16614889	0.17148719	0.17782548	0.18316378	0.18850207	0.19484037	0.20017867	0.20751696	0.21185526	0.21719356	0.22253185	0.22887015	0.23420845	0.23954674	0.24488504	0.25022333	0.25656163	0.26189993	0.26723822	0.27257652	0.27891482	0.28525311	0.29159141	0.2969297	0.302268	0.3076063	0.31294459	0.31928289	0.32562119	0.33095948	0.33729778	0.34263608	0.34897437	0.35431267	0.35965096	0.37098926	0.37532756	0.38066585	0.38700415	0.39234245	0.39868074	0.40801904	0.41335733	0.41969563	0.42603393	0.433372219	0.439710519	0.447048819	0.453387109	0.460725409	0.470063709	0.475401999	0.483740299	0.490078589	0.498416889	0.507755189	0.500785689	0.555622819	0.556354489	0.564817079	0.564679249	0.574934879	0.581231999	0.587232979	0.597253889	0.609966889	0.623223598	0.570716628	0.57774912	0.58613825	0.59379536	0.59691218	0.60360622	0.6072347	0.61276645	0.6166445	0.64366524	0.7403334	0.76129965	0.75771154	0.77842647	0.78787801	0.79713853	0.8050507	0.82534752	0.85724317	0.89187292	0.86066403	0.88051762	0.88712775	0.8922361	0.89814412	0.91116314	0.94173355	0.94020019	0.96775411	0.98224854	0.99719118	0.9944033	1.02336718	1.0504185	1.06527839	1.08956411	1.11600097	1.15920445	1.18720627	1.25494317	1.26897363	1.34367095	1.37229323	1.4328152	1.50353383	1.58776273	1.56141277	1.60237806	1.64098168	1.61489404	1.62684843	1.66597976	1.56479151	1.54374963	1.60911647	1.66619629	1.65030426	1.52565434	1.65328337	1.5604166	1.59294089	1.72328818	1.71986058	1.73308854	1.74448326	1.85918283	1.86467141	1.96922601	1.94887975	1.84334081	1.65922596	1.70158848	1.76986255	1.82171575	1.93129993	1.98869902	1.92388222	1.97144376	2.06583237	2.08436458	2.1110497	2.1547656	2.15139864	1.92914739	2.08014892	2.26217994	2.34413044	2.30112641	2.52233465	2.8565201	2.9056378	2.9455171	3.0171416	3.2341855	3.4226883	3.5418718	3.6495817	3.6655957	3.7692833	3.8383218	3.9355717	4.0922947	4.2595879	4.4092558	4.5986968	4.7086254	4.8232028	5.0383879	5.2731129	5.3018913	5.4460621	5.6680986	5.6827371	5.6465876	5.9736077	6.1229874	6.19537	6.4517127	6.3572096	6.2128621	6.3174055	6.3355201	6.5500833	6.7193449	6.8972023	7.0470086	7.2807248	7.4126436	7.4634833	7.6159799	7.4215304	7.4221006	7.5315956	7.6470104	7.7611025	7.8371397	7.8028431	7.7517892	7.8838	8.0279	8.1807	8.5117	8.9148	9.1665	9.237	9.3075	9.3776666	9.44783337	9.518	9.58743	9.65686	9.72629	9.79572	9.86515	9.93458	10.00401	10.07344	10.14287	10.2123	10.30803	10.40376	10.49949	10.59522	10.69095	10.78668	10.88241	10.97814	11.07387	11.1696	11.20631	11.24302	11.27973	11.31644	11.35315	11.38986	11.42657	11.46328	11.49999	11.5367	11.51102	11.48534	11.45966	11.43398	11.4083	11.38262	11.35694	11.33126	11.30558	11.2799	11.11044	10.94098	10.77152	10.60206	10.4326	10.26314	10.09368	9.92422	9.75476	9.5853	9.34897	9.11264	8.87631	8.63998	8.40365	8.16732	7.93099	7.69466	7.45833	7.222	6.91879	6.61558	6.31237	6.00916	5.70595	5.40274	5.09953	4.79632	4.49311	4.1899	4.19287	4.19584	4.19881	4.20178	4.20475	4.20772	4.21069	4.21366	4.21663	4.2196	4.22257	4.22554	4.22851	4.23148	4.23445	4.23742	4.24039	4.24336	4.24633	4.2493	4.13531	4.02132	3.90733	3.79334	3.67935	3.56536	3.45137	3.33738	3.22339	3.1094	3.02783	2.94626	2.86469	2.78312	2.70155	2.61998	2.53841	2.45684	2.37527	2.2937	2.26073	2.22776	2.19479	2.16182	2.12885	2.09588	2.06291	2.02994	1.99697	1.964	1.93853	1.91306	1.88759	1.86212	1.83665	1.81118	1.78571	1.76024	1.73477	1.7093	1.6831375	1.656975	1.6308125	1.60465	1.5784875	1.552325	1.5261625	1.5	1.5354	1.5468	1.5531	1.5547	1.5527	1.5482	1.5419	1.5324	1.5229	1.5134	1.5039	1.4944	1.48311	1.47182	1.46053	1.44924	1.43795	1.42666	1.41537	1.40408	1.39279	1.3815	1.3712	1.3609	1.3506	1.3403	1.33	1.3197	1.3094	1.2991	1.2888	1.2785	1.26966	1.26082	1.25198	1.24314	1.2343	1.22546	1.21662	1.20778	1.19894	1.1901	1.18257	1.17504	1.16751	1.15998	1.15245	1.14492	1.13739	1.12986	1.12233	1.1148	1.10836	1.10192	1.09548	1.08904	1.0826	1.07616	1.06972	1.06328	1.05684	1.0504	1.04486	1.03932	1.03378	1.02824	1.0227	1.01716	1.01162	1.00608	1.00054	0.995	0.99023	0.98546	0.98069	0.97592	0.97115	0.96638	0.96161	0.95684	0.95207	0.9473	0.94314	0.93898	0.93482	0.93066	0.9265	0.92234	0.91818	0.91402	0.90986	0.9057	0.90206	0.89842	0.89478	0.89114	0.8875	0.88386	0.88022	0.87658	0.87294	0.8693	0.8661	0.8629	0.8597	0.8565	0.8533	0.8501	0.8469	0.8437	0.8405	0.8373	0.83445	0.8316	0.82875	0.8259	0.82305	0.8202	0.81735	0.8145	0.81165	0.8088	0.80629	0.80378	0.80127	0.79876	0.79625	0.79374	0.79123	0.78872	0.78621	0.7837	0.78142	0.77914	0.77686	0.77458	0.7723	0.77002	0.76774	0.76546	0.76318	0.7609	0.75884	0.75678	0.75472	0.75266	0.7506	0.74854	0.74648	0.74442	0.74236	0.7403	0.738714	0.737128	0.735542	0.733956	0.73237	0.730784	0.729198	0.727612	0.726026	0.72444	0.722854	0.721268	0.719682	0.718096	0.71651	0.714924	0.713338	0.711752	0.710166	0.70858	0.706994	0.705408	0.703822	0.702236	0.70065	0.699064	0.697478	0.695892	0.694306	0.69272	0.691134	0.689548	0.687962	0.686376	0.68479	0.683204	0.681618	0.680032	0.678446	0.67686	0.675274	0.673688	0.672102	0.670516	0.66893	0.667344	0.665758	0.664172	0.662586	0.661	0.659886	0.658772	0.657658	0.656544	0.65543	0.654316	0.653202	0.652088	0.650974	0.64986	0.648746	0.647632	0.646518	0.645404	0.64429	0.643176	0.642062	0.640948	0.639834	0.63872	0.637606	0.636492	0.635378	0.634264	0.63315	0.632036	0.630922	0.629808	0.628694	0.62758	0.626466	0.625352	0.624238	0.623124	0.62201	0.620896	0.619782	0.618668	0.617554	0.61644	0.615326	0.614212	0.613098	0.611984	0.61087	0.609756	0.608642	0.607528	0.606414	0.6053	0.604434	0.603568	0.602702	0.601836	0.60097	0.600104	0.599238	0.598372	0.597506	0.59664	0.595774	0.594908	0.594042	0.593176	0.59231	0.591444	0.590578	0.589712	0.588846	0.58798	0.587114	0.586248	0.585382	0.584516	0.58365	0.582784	0.581918	0.581052	0.580186	0.57932	0.578454	0.577588	0.576722	0.575856	0.57499	0.574124	0.573258	0.572392	0.571526	0.57066	0.569794	0.568928	0.568062	0.567196	0.56633	0.565464	0.564598	0.563732	0.562866	0.562	0.56425	0.5665	0.56875	0.571	0.57325	0.5755	0.57775	0.58	0.58225	0.5845	0.58675	0.589	0.59125	0.5935	0.59575	0.598	0.60025	0.6025	0.60475	0.607	0.60925	0.6115	0.61375	0.616	0.61825	0.6205	0.62275	0.625	0.62725	0.6295	0.63175	0.634	0.63625	0.6385	0.64075	0.643	0.64525	0.6475	0.64975	0.652	0.65425	0.6565	0.65875	0.661	0.66325	0.6655	0.66775	0.67	0.67225	0.6745]; % Example function
tspan=1:numel(U);

RF = @(U) 5.35 * log(U ./ (0.469 *600));

plot(tspan,Tot_Rad , 'LineWidth',2) %Plot of total radiative forcing.
hold on;
plot(tspan,RF(CO2ConcRCP45),'LineWidth',2)
legend("Actual RF", "RF function CO2")

%% Uppgift 10a

tspan=1:4*10^3;
lambda = 0.8;
dt = 1;
k = 0.5;
c_1 = (4186 * 50 * 1020)/(60*60*24*365);
c_2 = (4186 * 2000 * 1020)/(60*60*24*365);

RF=ones(1,length(tspan));
RF(1)=0;
dT_1=@(t,T_1,T_2,RF,lambda,k) 1/c_1.*(RF-T_1/lambda-k.*(T_1-T_2));  
dT_2=@(t,T_1,T_2,RF,lambda,k) 1/c_2.*(k.*(T_1-T_2));

T_1=zeros(1,length(tspan));
T_2=zeros(1,length(tspan));




%Euler Forward Method to iteratively fill the B vectors.
for t=1:(length(tspan)-1)
    
    T_1(1,t + dt) = T_1(t) + dT_1(t, T_1(t), T_2(t),RF(t),lambda,k)*dt;
    T_2(1,t + dt) = T_2(t) + dT_2(t, T_1(t), T_2(t),RF(t),lambda,k)*dt;
end


hold on;
plot(tspan,T_1,'LineWidth',2)
plot(tspan,T_2,'LineWidth',2)


%% Uppgift 10b

tspan=1:4*10^3;
lambda = [0.2 0.6 1];
dt = 1;
k = [0.5 0.8 1.3];
c_1 = (4186 * 50 * 1020)/(60*60*24*365);
c_2 = (4186 * 2000 * 1020)/(60*60*24*365);

RF=ones(1,length(tspan));
RF(1)=0;
dT_1=@(t,T_1,T_2,RF,lambda,k) 1/c_1.*(RF-T_1/lambda-k.*(T_1-T_2));  
dT_2=@(t,T_1,T_2,RF,lambda,k) 1/c_2.*(k.*(T_1-T_2));

T_1=zeros(1,length(tspan));
T_2=zeros(1,length(tspan));

q = 1;
for i = k

for j = lambda

%Euler Forward Method to iteratively fill the B vectors.
for t=1:(length(tspan)-1)
    
    T_1(1,t + dt) = T_1(t) + dT_1(t, T_1(t), T_2(t),RF(t),j,i)*dt;
    T_2(1,t + dt) = T_2(t) + dT_2(t, T_1(t), T_2(t),RF(t),j,i)*dt;
end

x = ones(1,length(tspan)) .* ((1-exp(-1)) * j);

subplot(3,3,q)
hold on;
plot(tspan,T_1,'LineWidth',2)
plot(tspan,T_2,'LineWidth',2)
plot(tspan, x, 'LineWidth',2)
q = q + 1;

end


end




%Större värden på lambda förskjuter konvergenspunkten längre bort
%Större värden på k ökar blandningen mellan haven vilket leder till att
%konvergensen sker snabbare.


%% Uppgift 10c


%Med ett lägre värde på K sker ett mindre energiutbyte mellan ythavet och
%djuphavet, på så sätt lagras majoriteten av energin i ythavet. Om man
%sedan låter lambda vara litet sker ett större energiutskick från ythavet
%till rymden. Dessa två faktorer bidrar tillsammans till att strålningen ut
%till rymden maximeras. 
%På samma sätt gäller att för stort värde på k och stort värde på lambda
%låter vi majoriteten av systemets energi skickas till djuphavet istället. 


tspan=1:4*10^3;
lambda = [0.2 0.6 1];
dt = 1;
k = [0.5 0.8 1.3];
c_1 = (4186 * 50 * 1020)/(60*60*24*365);
c_2 = (4186 * 2000 * 1020)/(60*60*24*365);

RF=ones(1,length(tspan));
RF(1)=0;
dT_1=@(t,T_1,T_2,RF,lambda,k) 1/c_1.*(RF-T_1/lambda-k.*(T_1-T_2));  
dT_2=@(t,T_1,T_2,RF,lambda,k) 1/c_2.*(k.*(T_1-T_2));

T_1=zeros(1,length(tspan));
T_2=zeros(1,length(tspan));

q = 1;
for i = k

for j = lambda

%Euler Forward Method to iteratively fill the B vectors.
for t=1:(length(tspan)-1)
    
    T_1(1,t + dt) = T_1(t) + dT_1(t, T_1(t), T_2(t),RF(t),j,i)*dt;
    T_2(1,t + dt) = T_2(t) + dT_2(t, T_1(t), T_2(t),RF(t),j,i)*dt;
end

x = ones(1,length(tspan)) .* ((1-exp(-1)) * j);

subplot(3,3,q)
hold on;
plot(tspan,T_1,'LineWidth',2)
plot(tspan,T_2,'LineWidth',2)
plot(tspan, x, 'LineWidth',2)
q = q + 1;

end


end


%% Uppgift 11

run('radiativeForcingRCP45.m') 
run('koncentrationerRCP45.m') 
run('NASA_GISS.m')

U= [0.003	0.008338296	0.013676593	0.019014889	0.024353185	0.029691482	0.036029778	0.041368074	0.046706371	0.052044667	0.057382963	0.062721259	0.068059556	0.073397852	0.078736148	0.084074445	0.090412741	0.095751037	0.101089334	0.10642763	0.11176593	0.11710422	0.12244252	0.12778082	0.13311911	0.13845741	0.1447957	0.150134	0.1554723	0.16081059	0.16614889	0.17148719	0.17782548	0.18316378	0.18850207	0.19484037	0.20017867	0.20751696	0.21185526	0.21719356	0.22253185	0.22887015	0.23420845	0.23954674	0.24488504	0.25022333	0.25656163	0.26189993	0.26723822	0.27257652	0.27891482	0.28525311	0.29159141	0.2969297	0.302268	0.3076063	0.31294459	0.31928289	0.32562119	0.33095948	0.33729778	0.34263608	0.34897437	0.35431267	0.35965096	0.37098926	0.37532756	0.38066585	0.38700415	0.39234245	0.39868074	0.40801904	0.41335733	0.41969563	0.42603393	0.433372219	0.439710519	0.447048819	0.453387109	0.460725409	0.470063709	0.475401999	0.483740299	0.490078589	0.498416889	0.507755189	0.500785689	0.555622819	0.556354489	0.564817079	0.564679249	0.574934879	0.581231999	0.587232979	0.597253889	0.609966889	0.623223598	0.570716628	0.57774912	0.58613825	0.59379536	0.59691218	0.60360622	0.6072347	0.61276645	0.6166445	0.64366524	0.7403334	0.76129965	0.75771154	0.77842647	0.78787801	0.79713853	0.8050507	0.82534752	0.85724317	0.89187292	0.86066403	0.88051762	0.88712775	0.8922361	0.89814412	0.91116314	0.94173355	0.94020019	0.96775411	0.98224854	0.99719118	0.9944033	1.02336718	1.0504185	1.06527839	1.08956411	1.11600097	1.15920445	1.18720627	1.25494317	1.26897363	1.34367095	1.37229323	1.4328152	1.50353383	1.58776273	1.56141277	1.60237806	1.64098168	1.61489404	1.62684843	1.66597976	1.56479151	1.54374963	1.60911647	1.66619629	1.65030426	1.52565434	1.65328337	1.5604166	1.59294089	1.72328818	1.71986058	1.73308854	1.74448326	1.85918283	1.86467141	1.96922601	1.94887975	1.84334081	1.65922596	1.70158848	1.76986255	1.82171575	1.93129993	1.98869902	1.92388222	1.97144376	2.06583237	2.08436458	2.1110497	2.1547656	2.15139864	1.92914739	2.08014892	2.26217994	2.34413044	2.30112641	2.52233465	2.8565201	2.9056378	2.9455171	3.0171416	3.2341855	3.4226883	3.5418718	3.6495817	3.6655957	3.7692833	3.8383218	3.9355717	4.0922947	4.2595879	4.4092558	4.5986968	4.7086254	4.8232028	5.0383879	5.2731129	5.3018913	5.4460621	5.6680986	5.6827371	5.6465876	5.9736077	6.1229874	6.19537	6.4517127	6.3572096	6.2128621	6.3174055	6.3355201	6.5500833	6.7193449	6.8972023	7.0470086	7.2807248	7.4126436	7.4634833	7.6159799	7.4215304	7.4221006	7.5315956	7.6470104	7.7611025	7.8371397	7.8028431	7.7517892	7.8838	8.0279	8.1807	8.5117	8.9148	9.1665	9.237	9.3075	9.3776666	9.44783337	9.518	9.58743	9.65686	9.72629	9.79572	9.86515	9.93458	10.00401	10.07344	10.14287	10.2123	10.30803	10.40376	10.49949	10.59522	10.69095	10.78668	10.88241	10.97814	11.07387	11.1696	11.20631	11.24302	11.27973	11.31644	11.35315	11.38986	11.42657	11.46328	11.49999	11.5367	11.51102	11.48534	11.45966	11.43398	11.4083	11.38262	11.35694	11.33126	11.30558	11.2799	11.11044	10.94098	10.77152	10.60206	10.4326	10.26314	10.09368	9.92422	9.75476	9.5853	9.34897	9.11264	8.87631	8.63998	8.40365	8.16732	7.93099	7.69466	7.45833	7.222	6.91879	6.61558	6.31237	6.00916	5.70595	5.40274	5.09953	4.79632	4.49311	4.1899	4.19287	4.19584	4.19881	4.20178	4.20475	4.20772	4.21069	4.21366	4.21663	4.2196	4.22257	4.22554	4.22851	4.23148	4.23445	4.23742	4.24039	4.24336	4.24633	4.2493	4.13531	4.02132	3.90733	3.79334	3.67935	3.56536	3.45137	3.33738	3.22339	3.1094	3.02783	2.94626	2.86469	2.78312	2.70155	2.61998	2.53841	2.45684	2.37527	2.2937	2.26073	2.22776	2.19479	2.16182	2.12885	2.09588	2.06291	2.02994	1.99697	1.964	1.93853	1.91306	1.88759	1.86212	1.83665	1.81118	1.78571	1.76024	1.73477	1.7093	1.6831375	1.656975	1.6308125	1.60465	1.5784875	1.552325	1.5261625	1.5	1.5354	1.5468	1.5531	1.5547	1.5527	1.5482	1.5419	1.5324	1.5229	1.5134	1.5039	1.4944	1.48311	1.47182	1.46053	1.44924	1.43795	1.42666	1.41537	1.40408	1.39279	1.3815	1.3712	1.3609	1.3506	1.3403	1.33	1.3197	1.3094	1.2991	1.2888	1.2785	1.26966	1.26082	1.25198	1.24314	1.2343	1.22546	1.21662	1.20778	1.19894	1.1901	1.18257	1.17504	1.16751	1.15998	1.15245	1.14492	1.13739	1.12986	1.12233	1.1148	1.10836	1.10192	1.09548	1.08904	1.0826	1.07616	1.06972	1.06328	1.05684	1.0504	1.04486	1.03932	1.03378	1.02824	1.0227	1.01716	1.01162	1.00608	1.00054	0.995	0.99023	0.98546	0.98069	0.97592	0.97115	0.96638	0.96161	0.95684	0.95207	0.9473	0.94314	0.93898	0.93482	0.93066	0.9265	0.92234	0.91818	0.91402	0.90986	0.9057	0.90206	0.89842	0.89478	0.89114	0.8875	0.88386	0.88022	0.87658	0.87294	0.8693	0.8661	0.8629	0.8597	0.8565	0.8533	0.8501	0.8469	0.8437	0.8405	0.8373	0.83445	0.8316	0.82875	0.8259	0.82305	0.8202	0.81735	0.8145	0.81165	0.8088	0.80629	0.80378	0.80127	0.79876	0.79625	0.79374	0.79123	0.78872	0.78621	0.7837	0.78142	0.77914	0.77686	0.77458	0.7723	0.77002	0.76774	0.76546	0.76318	0.7609	0.75884	0.75678	0.75472	0.75266	0.7506	0.74854	0.74648	0.74442	0.74236	0.7403	0.738714	0.737128	0.735542	0.733956	0.73237	0.730784	0.729198	0.727612	0.726026	0.72444	0.722854	0.721268	0.719682	0.718096	0.71651	0.714924	0.713338	0.711752	0.710166	0.70858	0.706994	0.705408	0.703822	0.702236	0.70065	0.699064	0.697478	0.695892	0.694306	0.69272	0.691134	0.689548	0.687962	0.686376	0.68479	0.683204	0.681618	0.680032	0.678446	0.67686	0.675274	0.673688	0.672102	0.670516	0.66893	0.667344	0.665758	0.664172	0.662586	0.661	0.659886	0.658772	0.657658	0.656544	0.65543	0.654316	0.653202	0.652088	0.650974	0.64986	0.648746	0.647632	0.646518	0.645404	0.64429	0.643176	0.642062	0.640948	0.639834	0.63872	0.637606	0.636492	0.635378	0.634264	0.63315	0.632036	0.630922	0.629808	0.628694	0.62758	0.626466	0.625352	0.624238	0.623124	0.62201	0.620896	0.619782	0.618668	0.617554	0.61644	0.615326	0.614212	0.613098	0.611984	0.61087	0.609756	0.608642	0.607528	0.606414	0.6053	0.604434	0.603568	0.602702	0.601836	0.60097	0.600104	0.599238	0.598372	0.597506	0.59664	0.595774	0.594908	0.594042	0.593176	0.59231	0.591444	0.590578	0.589712	0.588846	0.58798	0.587114	0.586248	0.585382	0.584516	0.58365	0.582784	0.581918	0.581052	0.580186	0.57932	0.578454	0.577588	0.576722	0.575856	0.57499	0.574124	0.573258	0.572392	0.571526	0.57066	0.569794	0.568928	0.568062	0.567196	0.56633	0.565464	0.564598	0.563732	0.562866	0.562	0.56425	0.5665	0.56875	0.571	0.57325	0.5755	0.57775	0.58	0.58225	0.5845	0.58675	0.589	0.59125	0.5935	0.59575	0.598	0.60025	0.6025	0.60475	0.607	0.60925	0.6115	0.61375	0.616	0.61825	0.6205	0.62275	0.625	0.62725	0.6295	0.63175	0.634	0.63625	0.6385	0.64075	0.643	0.64525	0.6475	0.64975	0.652	0.65425	0.6565	0.65875	0.661	0.66325	0.6655	0.66775	0.67	0.67225	0.6745]; % Example function
CO2ConcRCP45 =	[278.05158	278.10615	278.22039	278.34305	278.47058	278.60047	278.73275	278.86881	279.00907	279.15318	279.3018	279.4568	279.61808	279.78192	279.9432	280.0974	280.2428	280.38168	280.51832	280.6572	280.8026	280.9568	281.11808	281.28192	281.4432	281.5982	281.74682	281.89093	282.03119	282.16725	282.29901	282.4268	282.55093	282.67123	282.7873	282.89901	283.00677	283.11093	283.21129	283.30737	283.39963	283.48978	283.57796	283.66116	283.73511	283.79676	283.84667	283.88853	283.92613	283.96267	284.00107	284.04267	284.08613	284.12853	284.16667	284.1982	284.22333	284.24427	284.26307	284.28133	284.30027	284.32	284.34	284.36	284.38	284.4	284.385	284.28	284.125	283.975	283.825	283.675	283.525	283.425	283.4	283.4	283.425	283.5	283.6	283.725	283.9	284.075	284.225	284.4	284.575	284.725	284.875	285	285.125	285.275	285.425	285.575	285.725	285.9	286.075	286.225	286.375	286.5	286.625	286.775	286.9	287	287.1	287.225	287.375	287.525	287.7	287.9	288.125	288.4	288.7	289.025	289.4	289.8	290.225	290.7	291.2	291.675	292.125	292.575	292.975	293.3	293.575	293.8	294	294.175	294.325	294.475	294.6	294.7	294.8	294.9	295.025	295.225	295.5	295.8	296.125	296.475	296.825	297.2	297.625	298.075	298.5	298.9	299.3	299.7	300.075	300.425	300.775	301.1	301.4	301.725	302.075	302.4	302.7	303.025	303.4	303.775	304.125	304.525	304.975	305.4	305.825	306.3	306.775	307.225	307.7	308.175	308.6	309	309.4	309.75	310	310.175	310.3	310.375	310.375	310.3	310.2	310.125	310.1	310.125	310.2	310.325	310.5	310.75	311.1	311.5	311.925	312.425	313	313.6	314.225	314.8475	315.5	316.2725	317.075	317.795	318.3975	318.925	319.6475	320.6475	321.605	322.635	323.9025	324.985	325.855	327.14	328.6775	329.7425	330.585	331.7475	333.2725	334.8475	336.525	338.36	339.7275	340.7925	342.1975	343.7825	345.2825	346.7975	348.645	350.7375	352.4875	353.855	355.0175	355.885	356.7775	358.1275	359.8375	361.4625	363.155	365.3225	367.3475	368.865	370.4675	372.5225	374.76	376.8125	378.8125	380.8275	382.7775	384.8	386.9516	389.12785	391.27357	393.4211	395.58283	397.76408	399.96631	402.18432	404.41077	406.64292	408.8817	411.12868	413.37804	415.63944	417.93551	420.27395	422.65593	425.07983	427.53791	430.0206	432.5234	435.04594	437.58886	440.13137	442.66419	445.20699	447.76978	450.35539	452.96337	455.58649	458.2152	460.84499	463.47549	466.09336	468.67807	471.23389	473.78031	476.32819	478.88085	481.43826	483.99308	486.53532	489.06035	491.53558	493.93186	496.24365	498.47436	500.64502	502.76788	504.84729	506.88408	508.87135	510.79905	512.64717	514.40151	516.06461	517.62854	519.09606	520.48828	521.81772	523.08871	524.30217	525.45089	526.50901	527.45707	528.29593	529.02718	529.64253	530.14419	530.55341	530.88313	531.13797	531.31935	531.48991	531.70213	531.94208	532.20472	532.48672	532.77553	533.06978	533.38792	533.74072	534.13086	534.55754	535.01142	535.47962	535.95487	536.4351	536.91986	537.39855	537.87136	538.3583	538.8715	539.38819	539.88381	540.35213	540.78203	541.16804	541.50962	541.80769	542.05261	542.24555	542.40767	542.55941	542.71221	542.86612	543.01262	543.13926	543.23925	543.31105	543.35475	543.35993	543.32712	543.28815	543.26597	543.26382	543.28162	543.31031	543.337	543.35452	543.36102	543.35628	543.32954	543.28277	543.23814	543.20814	543.19691	543.20476	543.22301	543.23901	543.2458	543.24169	543.22663	543.18977	543.13128	543.07193	543.02451	542.9934	542.97911	542.97309	542.96279	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532	542.95532];

A = [0.113 0.213 0.258 0.273 0.1430];
tau = [2.0 12.2 50.4 243.3 inf];
len_tspan=2019-1765;
tspan=1:len_tspan;
k = 3.2*10^(-3);
M_0 = 600;
alpha21 = 15/600;
alpha23 = 45/600;
alpha31 = 45/1500;
beta = 0.65;
lambda = 0.6;
s=1;
kappa = 0.8;
c_1 = (4186 * 50 * 1020)/(60*60*24*365);
c_2 = (4186 * 2000 * 1020)/(60*60*24*365);

dt=1;

NPP=@(B1,beta) 60*(1+beta*log(B1/600));  %Function
dB_1=@(t,B1,B2,B3,beta) alpha31*B3+alpha21*B2-NPP(B1, beta)+U(t);  %Function
dB_2=@(t,B1,B2,B3,beta) NPP(B1, beta)-alpha23*B2-alpha21*B2;       %Function
dB_3=@(t,B1,B2,B3,beta)alpha23*B2-alpha31*B3;                %Function  
dT_1=@(t,T_1,T_2,RF,lambda,k) 1/c_1.*(RF-T_1/lambda-k.*(T_1-T_2));  
dT_2=@(t,T_1,T_2,RF,lambda,k) 1/c_2.*(k.*(T_1-T_2));


RF = @(U) 5.35 * log(U ./ (0.469 *600));

%Dummy vector to store CO2 amount.
B_1=zeros(1,length(U));
B_2=zeros(1,length(U));
B_3=zeros(1,length(U));
B_4=zeros(1,length(U));

B_1(1) = 600; 
B_2(1) = 600; 
B_3(1) = 1500;
B_4(1) = 0;

M=zeros(1,length(tspan));
utslapp_ant = zeros(1,length(tspan)-1 );
M(1)=M_0;




for t=1:length(tspan)-1
    sum_M=0;
    utslapp_ant(t) = dB_1(t, B_1(t), B_2(t), B_3(t), beta);
    
    for t_hat=1:t
        
        sum_I = 0;
        tau_i = tau .* (1 + k .* sum(utslapp_ant(1:t-1)) );
        for i = 1:length(A)
            sum_I = sum_I + A(i) .* exp(-(t - t_hat) ./ tau_i(i) );
        end
        sum_M=sum_M+sum_I*utslapp_ant(t_hat);
    end
    M(t+1)=M_0+sum_M;

    %Euler Forward Method to iteratively fill the B vectors.
    B_1(1,t + dt) = M(t);
    B_2(1,t + dt) = B_2(t) + dB_2(t, B_1(t), B_2(t), B_3(t), beta)*dt;
    B_3(1,t + dt) = B_3(t) + dB_3(t, B_1(t), B_2(t), B_3(t), beta)*dt;
    B_4(1,t + dt) = sum(U(1:t)) + B_1(1) + B_2(1) + B_3(1) -  B_1(t) + B_2(t) + B_3(t);

    Tot_Rad = RF(B_1(t)*0.469) + totRadForcExclCO2AndAerosols(t)*s + totRadForcAerosols(t)*s;
    T_1(1,t + dt) = T_1(t) + dT_1(t, T_1(t), T_2(t),RF(t),lambda,kappa)*dt;
    T_2(1,t + dt) = T_2(t) + dT_2(t, T_1(t), T_2(t),RF(t),lambda,kappa)*dt;
end

plot(1:length(TAnomali),TAnomali)
hold on;
T=T_1+T_2;
plot(1:length(TAnomali),T(115:139+115))
legend("Nasa", "Data")
